# 端末プロファイル統合改修 計画

## 背景
- Search/Gene­ration 両タブで共通して参照する ROM/ハード固有設定をバラバラに保持しており、再入力や設定ずれが発生しやすい。
- 既存 PresetManager は検索条件一式の保存を目的としており、端末固有のパラメータを横断的に共有する用途には不向き。
- 既存ツールでは端末情報バーが常設されており、同等の UX を実現するための構造整理が必要。

## 目的
- 端末固有の設定(ROM/リージョン/ハード/Timer0帯/MAC/TID/SID 等)を「端末プロファイル」として一元管理し、Search/Gene­ration UI から共通利用できるようにする。
- プロファイル操作 UI を追加し、PresetManager と役割を明確に分離したまま併用可能とする。

## スコープ
1. **データモデル整備**
   - `DeviceProfile` 型の新設と、Search/Gene­ration 両方から参照する必要項目の整理。
   - 既存 `SearchConditions`/`GenerationParamsHex` に重複保持している項目の関連づけ・同期方針の策定。
2. **ストア拡張**
   - `useAppStore` にプロファイルリスト、アクティブプロファイル、CRUD 操作、検索/生成状態への適用処理を追加。
   - `persist` 対応し、ローカル保存・復元パスを確保。
3. **UI 改修**
   - Search 設定カード上部へのプロファイルセレクタ導入。
   - Generation パラメータカードとの双方向同期。
   - 共通バー or ダイアログでのプロファイル編集・保存・複製 UI を実装。
4. **互換性確保**
   - PresetManager との併用シナリオ整理（プリセット適用時のプロファイル再適用ルールなど）。
   - 既存設定を保持したまま移行できる初期化処理の追加。

## 実装タスク(想定)
1. 型・ユーティリティ層
   - `src/types/profile.ts`(仮) で型定義とバリデーション補助を実装。
   - MAC アドレス / レンジ入力のフォーマットヘルパーを共用化。
2. ストア
   - `app-store.ts` にプロファイル slice を追加し、`createGenerationSlice` との整合を確認。
   - 初期プロファイルのデフォルト値生成ロジックを実装。
3. UI
   - Search 側: `ROMConfigurationCard` と `ParameterConfigurationCard` を `activeProfile` 依存に改修。
   - Generation 側: `GenerationParamsCard` の初期値・プロファイル同期処理を実装。
   - プロファイル管理コンポーネント(選択ドロップダウン + 保存/編集ボタン + 編集ダイアログ)を `components/layout` or 共通パーツとして新設。
4. 移行・テスト
   - 既存ローカルストレージからの移行パス（初回起動時にプロファイル生成）。
   - 単体テスト: プロファイル適用処理、ストアの同期ロジック。
   - UI テスト(手動/Playwright)で Search→Generation 連携を確認。

## リスク・検討事項
- プロファイルとプリセットの相互作用: プリセット適用時にプロファイルが上書きされないようルール化が必要。
- 世代別固有項目の対応（例: BW/BW2でメモリリンク有無の制御）をプロファイルでどう扱うか。
- 既存ローカルストレージ rev の更新による互換性問題。マイグレーション処理を忘れると既存ユーザーの設定が失われる可能性。
- UI 設置場所: ヘッダー常設バーとカード内コントロールの責務分担を明確化する必要がある。
