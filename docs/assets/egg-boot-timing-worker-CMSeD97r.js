var T=(e=>(e[e.BwNew=0]="BwNew",e[e.BwContinue=1]="BwContinue",e[e.Bw2New=2]="Bw2New",e[e.Bw2Continue=3]="Bw2Continue",e))(T||{});let g=null,R=null;async function $(){return g||R||(R=(async()=>{try{const e=await import("./wasm_pkg-XwWEDZau.js");let n;if(typeof process<"u"&&!!process.versions?.node){const o=await import("./__vite-browser-external-9wXp6ZBx.js"),i=(await import("./__vite-browser-external-9wXp6ZBx.js")).join(process.cwd(),"src/wasm/wasm_pkg_bg.wasm");n={module_or_path:o.readFileSync(i)}}else n={module_or_path:new URL("/pokemon-gen5-initseed/assets/wasm_pkg_bg-yRRHAhfR.wasm",import.meta.url)};return await e.default(n),g={BWGenerationConfig:e.BWGenerationConfig,PokemonGenerator:e.PokemonGenerator,SeedEnumerator:e.SeedEnumerator,EncounterType:e.EncounterType,GameVersion:e.GameVersion,GameMode:e.GameMode,EggSeedEnumeratorJs:e.EggSeedEnumeratorJs,ParentsIVsJs:e.ParentsIVsJs,GenerationConditionsJs:e.GenerationConditionsJs,EverstonePlanJs:e.EverstonePlanJs,IndividualFilterJs:e.IndividualFilterJs,TrainerIds:e.TrainerIds,GenderRatio:e.GenderRatio,StatRange:e.StatRange,EggBootTimingSearchResult:e.EggBootTimingSearchResult,EggBootTimingSearchIterator:e.EggBootTimingSearchIterator,DSConfigJs:e.DSConfigJs,SegmentParamsJs:e.SegmentParamsJs,TimeRangeParamsJs:e.TimeRangeParamsJs,SearchRangeParamsJs:e.SearchRangeParamsJs,MtSeedBootTimingSearchIterator:e.MtSeedBootTimingSearchIterator,MtSeedBootTimingSearchResult:e.MtSeedBootTimingSearchResult,MtSeedBootTimingSearchResults:e.MtSeedBootTimingSearchResults,calculate_game_offset:e.calculate_game_offset,sha1_hash_batch:e.sha1_hash_batch},g}catch(e){throw console.error("Failed to load WebAssembly module:",e),g=null,R=null,e}})(),R)}function j(){if(!g)throw new Error("WebAssembly module not initialized. Call initWasm() first.");return g}function X(){return g!==null}const E=[["A",0],["B",1],["Select",2],["Start",3],["[→]",4],["[←]",5],["[↑]",6],["[↓]",7],["R",8],["L",9],["X",10],["Y",11]],d=E.reduce((e,[n,t])=>(e[n]=t,e),{}),N=E.length,z=(1<<N)-1,C=12287,Q=[1<<d["[↑]"]|1<<d["[↓]"],1<<d["[←]"]|1<<d["[→]"],1<<d.Select|1<<d.Start|1<<d.L|1<<d.R];function I(e,n){return Number.isFinite(e)?n==="mask"?e&z:(e&C^C)&z:0}function Z(e){const n=[];for(const[t,o]of E)(e&1<<o)!==0&&n.push(t);return n}function ee(e){const n=I(e,"mask");for(const t of Q)if((n&t)===t)return!0;return!1}function ne(e){const n=I(e,"code");return Z(n)}function te(e){const n=I(e,"mask"),t=[];for(let i=0;i<N;i+=1)(n&1<<i)!==0&&t.push(i);const o=[],s=1<<t.length;for(let i=0;i<s;i+=1){let r=0;for(let l=0;l<t.length;l+=1)(i&1<<l)!==0&&(r|=1<<t[l]);ee(r)||o.push((r^C)>>>0)}return o}const oe={B:{JPN:{nazo:[35741456,35741708,35741708,35741784,35741784],vcountTimerRanges:[{vcount:96,timer0Min:3193,timer0Max:3194}]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[{vcount:96,timer0Min:3204,timer0Max:3205}]},USA:{nazo:[35741872,35742124,35742124,35742200,35742200],vcountTimerRanges:[{vcount:96,timer0Min:3195,timer0Max:3196}]},GER:{nazo:[35741680,35741932,35741932,35742008,35742008],vcountTimerRanges:[{vcount:95,timer0Min:3191,timer0Max:3192}]},FRA:{nazo:[35741744,35741996,35741996,35742072,35742072],vcountTimerRanges:[{vcount:95,timer0Min:3187,timer0Max:3188}]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[{vcount:96,timer0Min:3206,timer0Max:3207}]},ITA:{nazo:[35741616,35741868,35741868,35741944,35741944],vcountTimerRanges:[{vcount:95,timer0Min:3178,timer0Max:3179}]}},W:{JPN:{nazo:[35741488,35741740,35741740,35741816,35741816],vcountTimerRanges:[{vcount:95,timer0Min:3175,timer0Max:3177}]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[{vcount:96,timer0Min:3195,timer0Max:3196}]},USA:{nazo:[35741904,35742156,35742156,35742232,35742232],vcountTimerRanges:[{vcount:96,timer0Min:3198,timer0Max:3200}]},GER:{nazo:[35741712,35741964,35741964,35742040,35742040],vcountTimerRanges:[{vcount:96,timer0Min:3194,timer0Max:3195}]},FRA:{nazo:[35741776,35742028,35742028,35742104,35742104],vcountTimerRanges:[{vcount:95,timer0Min:3182,timer0Max:3183}]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[{vcount:95,timer0Min:3184,timer0Max:3185}]},ITA:{nazo:[35741648,35741900,35741900,35741976,35741976],vcountTimerRanges:[{vcount:96,timer0Min:3195,timer0Max:3196}]}},B2:{JPN:{nazo:[34187484,33790665,35649968,35650052,35650052],vcountTimerRanges:[{vcount:130,timer0Min:4354,timer0Max:4360}]},KOR:{nazo:[34190860,33793237,35653456,35653540,35653540],vcountTimerRanges:[{vcount:130,timer0Min:4335,timer0Max:4340}]},USA:{nazo:[34189032,33791465,35651600,35651684,35651684],vcountTimerRanges:[{vcount:130,timer0Min:4354,timer0Max:4360}]},GER:{nazo:[34188840,33791337,35651408,35651492,35651492],vcountTimerRanges:[{vcount:129,timer0Min:4325,timer0Max:4328},{vcount:130,timer0Min:4329,timer0Max:4332}]},FRA:{nazo:[34189064,33791481,35651632,35651716,35651716],vcountTimerRanges:[{vcount:130,timer0Min:4340,timer0Max:4344}]},SPA:{nazo:[34188968,33791417,35651536,35651620,35651620],vcountTimerRanges:[{vcount:130,timer0Min:4353,timer0Max:4358}]},ITA:{nazo:[34188776,33791337,35651344,35651428,35651428],vcountTimerRanges:[{vcount:130,timer0Min:4359,timer0Max:4361},{vcount:131,timer0Min:4361,timer0Max:4365}]}},W2:{JPN:{nazo:[34187516,33790709,3565e4,35650084,35650084],vcountTimerRanges:[{vcount:130,timer0Min:4341,timer0Max:4347}]},KOR:{nazo:[34190892,33793281,35653488,35653572,35653572],vcountTimerRanges:[{vcount:129,timer0Min:4324,timer0Max:4329}]},USA:{nazo:[34189096,33791509,35651664,35651748,35651748],vcountTimerRanges:[{vcount:130,timer0Min:4338,timer0Max:4342}]},GER:{nazo:[34188872,33791381,35651440,35651524,35651524],vcountTimerRanges:[{vcount:130,timer0Min:4325,timer0Max:4333}]},FRA:{nazo:[34189096,33791525,35651664,35651748,35651748],vcountTimerRanges:[{vcount:130,timer0Min:4332,timer0Max:4336}]},SPA:{nazo:[34189e3,33791461,35651568,35651652,35651652],vcountTimerRanges:[{vcount:130,timer0Min:4335,timer0Max:4340}]},ITA:{nazo:[34188840,33791381,35651408,35651492,35651492],vcountTimerRanges:[{vcount:130,timer0Min:4351,timer0Max:4356}]}}},a={params:null,running:!1,stopRequested:!1};function re(e){switch(e){case T.BwNew:return 0;case T.BwContinue:return 2;case T.Bw2New:return 5;case T.Bw2Continue:return 7;default:return 2}}function ie(e,n,t){return new e.DSConfigJs(new Uint8Array(n.macAddress),new Uint32Array(t),n.hardware)}function se(e,n,t,o){return new e.SegmentParamsJs(n,t,o)}function ae(e,n){return new e.TimeRangeParamsJs(n.hour.start,n.hour.end,n.minute.start,n.minute.end,n.second.start,n.second.end)}function ce(e,n,t){return new e.SearchRangeParamsJs(n.getFullYear(),n.getMonth()+1,n.getDate(),t)}const A=self,f=e=>A.postMessage(e);f({type:"READY",version:"1"});A.onmessage=e=>{const n=e.data;(async()=>{try{switch(n.type){case"START_SEARCH":await ue(n.params);break;case"STOP":a.stopRequested=!0;break;default:break}}catch(t){const o=t instanceof Error?t.message:String(t);f({type:"ERROR",message:o,category:"RUNTIME",fatal:!1})}})()};async function ue(e){if(a.running)return;a.params=e,a.stopRequested=!1,a.running=!0;const n=performance.now();try{await me();const t=await Me(e,n),o={reason:a.stopRequested?"stopped":"completed",processedCombinations:t.processedSegments,totalCombinations:t.totalSegments,resultsCount:t.resultsCount,elapsedMs:performance.now()-n};f({type:"COMPLETE",payload:o})}catch(t){const o=t instanceof Error?t.message:String(t),s=t instanceof Error?t.stack:void 0;console.error("[EggBootTimingWorker] Search error:",o),s&&console.error("[EggBootTimingWorker] Stack trace:",s),console.error("[EggBootTimingWorker] Params:",JSON.stringify(e,(i,r)=>typeof r=="bigint"?r.toString():r)),f({type:"ERROR",message:o,category:"WASM_INIT",fatal:!0})}finally{J()}}async function me(){X()||await $()}function de(e,n){const t=oe[e];if(!t)throw new Error(`Unknown ROM version: ${e}`);const o=t[n];if(!o)throw new Error(`Unknown ROM region: ${n}`);return o.nazo}function ge(e,n){return n.type==="none"?e.EverstonePlanJs.None:e.EverstonePlanJs.fixed(n.nature)}function le(e,n){const t=new e.IndividualFilterJs;if(!n)return t;if(n.ivRanges&&Array.isArray(n.ivRanges))for(let o=0;o<6;o++){const s=n.ivRanges[o];s&&typeof s.min=="number"&&typeof s.max=="number"&&t.set_iv_range(o,s.min,s.max)}return n.nature!==void 0&&t.set_nature(n.nature),n.gender!==void 0&&t.set_gender(fe(n.gender)),n.ability!==void 0&&t.set_ability(n.ability),n.shiny!==void 0&&t.set_shiny(n.shiny),n.hiddenPowerType!==void 0&&t.set_hidden_power_type(n.hiddenPowerType),n.hiddenPowerPower!==void 0&&t.set_hidden_power_power(n.hiddenPowerPower),t}function fe(e){switch(e){case"male":return 0;case"female":return 1;case"genderless":return 2;default:return 0}}function ve(e){switch(e){case 0:return"male";case 1:return"female";case 2:return"genderless";default:return"male"}}function Se(e,n,t){return e?{type:"known",hpType:n,power:t}:{type:"unknown"}}function he(e,n){const t=Number(e.advance),o=[e.ivs[0]??0,e.ivs[1]??0,e.ivs[2]??0,e.ivs[3]??0,e.ivs[4]??0,e.ivs[5]??0];return{boot:{datetime:new Date(Date.UTC(e.year,e.month-1,e.date,e.hour,e.minute,e.second)),timer0:e.timer0,vcount:e.vcount,keyCode:e.keyCode,keyInputNames:ne(e.keyCode),macAddress:n},lcgSeedHex:e.lcgSeedHex,egg:{advance:t,isStable:e.isStable,egg:{lcgSeedHex:e.lcgSeedHex,mtSeedHex:e.mtSeedHex,ivs:o,nature:e.nature,gender:ve(e.gender),ability:e.ability,shiny:e.shiny,pid:e.pid,hiddenPower:Se(e.hpKnown,e.hpType,e.hpPower)}},isStable:e.isStable}}async function Me(e,n){const o=j();if(!o.EggBootTimingSearchIterator)throw new Error("EggBootTimingSearchIterator not exposed in WASM");const s=de(e.romVersion,e.romRegion),i=te(e.keyInputMask),{dateRange:r}=e,l=new Date(r.startYear,r.startMonth-1,r.startDay);let _;if(e.rangeSeconds!==void 0)_=e.rangeSeconds;else{const S=new Date(r.endYear,r.endMonth-1,r.endDay);_=Math.max(1,Math.floor((S.getTime()-l.getTime())/(1e3*60*60*24))+1)*24*60*60}const D=e.timer0Range.max-e.timer0Range.min+1,O=e.vcountRange.max-e.vcountRange.min+1,v=D*O*i.length,W=32,K=3600,F=500;let c=0,u=0,B=n;for(let S=e.timer0Range.min;S<=e.timer0Range.max&&c<e.maxResults;S++)for(let y=e.vcountRange.min;y<=e.vcountRange.max&&c<e.maxResults;y++)for(const U of i){if(a.stopRequested||c>=e.maxResults)return{resultsCount:c,processedSegments:u,totalSegments:v};const w=new o.ParentsIVsJs;w.male=e.parents.male,w.female=e.parents.female;const m=new o.GenerationConditionsJs;m.has_nidoran_flag=e.conditions.hasNidoranFlag,m.set_everstone(ge(o,e.conditions.everstone)),m.uses_ditto=e.conditions.usesDitto;const k=e.conditions.femaleParentAbility===2;m.allow_hidden_ability=k,m.female_parent_has_hidden=k,m.reroll_count=e.conditions.masudaMethod?3:0,m.set_trainer_ids(new o.TrainerIds(e.conditions.tid,e.conditions.sid)),m.set_gender_ratio(new o.GenderRatio(e.conditions.genderRatio.threshold,e.conditions.genderRatio.genderless));const L=le(o,e.filterDisabled?null:e.filter),H=ie(o,e,s),Y=se(o,S,y,U),V=ae(o,e.timeRange),q=ce(o,l,_),p=new o.EggBootTimingSearchIterator(H,Y,V,q,m,w,L,e.considerNpcConsumption,re(e.gameMode),BigInt(e.userOffset),e.advanceCount);try{for(;!p.isFinished&&c<e.maxResults&&!a.stopRequested;){const P=p.next_batch(W,K);if(P.length>0){const h=[];for(let M=0;M<P.length&&c<e.maxResults;M++){const x=P[M];h.push(he(x,e.macAddress)),c++}f({type:"RESULTS",payload:{results:h,batchIndex:u}})}const b=performance.now();if(b-B>=F){const h=b-n,M=u/v*100,x=u>0?h/u*(v-u):0;f({type:"PROGRESS",payload:{processedCombinations:u,totalCombinations:v,foundCount:c,progressPercent:M,elapsedMs:h,estimatedRemainingMs:x}}),B=b}}}finally{p.free?.(),m.free?.(),w.free?.()}u++}const G=performance.now()-n;return f({type:"PROGRESS",payload:{processedCombinations:u,totalCombinations:v,foundCount:c,progressPercent:100,elapsedMs:G,estimatedRemainingMs:0}}),{resultsCount:c,processedSegments:u,totalSegments:v}}function J(){a.running=!1,a.params=null,a.stopRequested=!1}A.onclose=()=>{J()};
