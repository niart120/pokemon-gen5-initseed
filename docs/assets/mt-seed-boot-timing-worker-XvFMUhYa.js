const A=[["A",0],["B",1],["Select",2],["Start",3],["[→]",4],["[←]",5],["[↑]",6],["[↓]",7],["R",8],["L",9],["X",10],["Y",11]],u=A.reduce((e,[t,n])=>(e[t]=n,e),{}),N=A.length,J=(1<<N)-1,w=12287,$=[1<<u["[↑]"]|1<<u["[↓]"],1<<u["[←]"]|1<<u["[→]"],1<<u.Select|1<<u.Start|1<<u.L|1<<u.R];function C(e,t){return Number.isFinite(e)?t==="mask"?e&J:(e&w^w)&J:0}function Q(e){const t=[];for(const[n,s]of A)(e&1<<s)!==0&&t.push(n);return t}function X(e){const t=C(e,"mask");for(const n of $)if((t&n)===n)return!0;return!1}function Z(e){const t=C(e,"code");return Q(t)}function ee(e){const t=C(e,"mask"),n=[];for(let a=0;a<N;a+=1)(t&1<<a)!==0&&n.push(a);const s=[],T=1<<n.length;for(let a=0;a<T;a+=1){let r=0;for(let l=0;l<n.length;l+=1)(a&1<<l)!==0&&(r|=1<<n[l]);X(r)||s.push((r^w)>>>0)}return s}let m=null,h=null;async function te(){return m||h||(h=(async()=>{try{const e=await import("./wasm_pkg-a4vq4PfG.js");let t;if(typeof process<"u"&&!!process.versions?.node){const s=await import("./__vite-browser-external-9wXp6ZBx.js"),a=(await import("./__vite-browser-external-9wXp6ZBx.js")).join(process.cwd(),"src/wasm/wasm_pkg_bg.wasm");t={module_or_path:s.readFileSync(a)}}else t={module_or_path:new URL("/pokemon-gen5-initseed/assets/wasm_pkg_bg-pGc6cmQm.wasm",import.meta.url)};return await e.default(t),m={BWGenerationConfig:e.BWGenerationConfig,PokemonGenerator:e.PokemonGenerator,SeedEnumerator:e.SeedEnumerator,EncounterType:e.EncounterType,GameVersion:e.GameVersion,GameMode:e.GameMode,EggSeedEnumeratorJs:e.EggSeedEnumeratorJs,ParentsIVsJs:e.ParentsIVsJs,GenerationConditionsJs:e.GenerationConditionsJs,EverstonePlanJs:e.EverstonePlanJs,IndividualFilterJs:e.IndividualFilterJs,TrainerIds:e.TrainerIds,GenderRatio:e.GenderRatio,StatRange:e.StatRange,EggBootTimingSearchResult:e.EggBootTimingSearchResult,EggBootTimingSearchIterator:e.EggBootTimingSearchIterator,DSConfigJs:e.DSConfigJs,SegmentParamsJs:e.SegmentParamsJs,TimeRangeParamsJs:e.TimeRangeParamsJs,SearchRangeParamsJs:e.SearchRangeParamsJs,MtSeedBootTimingSearchIterator:e.MtSeedBootTimingSearchIterator,MtSeedBootTimingSearchResult:e.MtSeedBootTimingSearchResult,MtSeedBootTimingSearchResults:e.MtSeedBootTimingSearchResults,IdAdjustmentSearchIterator:e.IdAdjustmentSearchIterator,IdAdjustmentSearchResult:e.IdAdjustmentSearchResult,IdAdjustmentSearchResults:e.IdAdjustmentSearchResults,calculate_game_offset:e.calculate_game_offset,sha1_hash_batch:e.sha1_hash_batch,mt_seed_search_segment:e.mt_seed_search_segment},m}catch(e){throw console.error("Failed to load WebAssembly module:",e),m=null,h=null,e}})(),h)}function ne(){if(!m)throw new Error("WebAssembly module not initialized. Call initWasm() first.");return m}function oe(){return m!==null}const se={B:{JPN:{nazo:[35741456,35741708,35741708,35741784,35741784],vcountTimerRanges:[{vcount:96,timer0Min:3193,timer0Max:3194}]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[{vcount:96,timer0Min:3204,timer0Max:3205}]},USA:{nazo:[35741872,35742124,35742124,35742200,35742200],vcountTimerRanges:[{vcount:96,timer0Min:3195,timer0Max:3196}]},GER:{nazo:[35741680,35741932,35741932,35742008,35742008],vcountTimerRanges:[{vcount:95,timer0Min:3191,timer0Max:3192}]},FRA:{nazo:[35741744,35741996,35741996,35742072,35742072],vcountTimerRanges:[{vcount:95,timer0Min:3187,timer0Max:3188}]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[{vcount:96,timer0Min:3206,timer0Max:3207}]},ITA:{nazo:[35741616,35741868,35741868,35741944,35741944],vcountTimerRanges:[{vcount:95,timer0Min:3178,timer0Max:3179}]}},W:{JPN:{nazo:[35741488,35741740,35741740,35741816,35741816],vcountTimerRanges:[{vcount:95,timer0Min:3175,timer0Max:3177}]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[{vcount:96,timer0Min:3195,timer0Max:3196}]},USA:{nazo:[35741904,35742156,35742156,35742232,35742232],vcountTimerRanges:[{vcount:96,timer0Min:3198,timer0Max:3200}]},GER:{nazo:[35741712,35741964,35741964,35742040,35742040],vcountTimerRanges:[{vcount:96,timer0Min:3194,timer0Max:3195}]},FRA:{nazo:[35741776,35742028,35742028,35742104,35742104],vcountTimerRanges:[{vcount:95,timer0Min:3182,timer0Max:3183}]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[{vcount:95,timer0Min:3184,timer0Max:3185}]},ITA:{nazo:[35741648,35741900,35741900,35741976,35741976],vcountTimerRanges:[{vcount:96,timer0Min:3195,timer0Max:3196}]}},B2:{JPN:{nazo:[34187484,33790665,35649968,35650052,35650052],vcountTimerRanges:[{vcount:130,timer0Min:4354,timer0Max:4360}]},KOR:{nazo:[34190860,33793237,35653456,35653540,35653540],vcountTimerRanges:[{vcount:130,timer0Min:4335,timer0Max:4340}]},USA:{nazo:[34189032,33791465,35651600,35651684,35651684],vcountTimerRanges:[{vcount:130,timer0Min:4354,timer0Max:4360}]},GER:{nazo:[34188840,33791337,35651408,35651492,35651492],vcountTimerRanges:[{vcount:129,timer0Min:4325,timer0Max:4328},{vcount:130,timer0Min:4329,timer0Max:4332}]},FRA:{nazo:[34189064,33791481,35651632,35651716,35651716],vcountTimerRanges:[{vcount:130,timer0Min:4340,timer0Max:4344}]},SPA:{nazo:[34188968,33791417,35651536,35651620,35651620],vcountTimerRanges:[{vcount:130,timer0Min:4353,timer0Max:4358}]},ITA:{nazo:[34188776,33791337,35651344,35651428,35651428],vcountTimerRanges:[{vcount:130,timer0Min:4359,timer0Max:4361},{vcount:131,timer0Min:4361,timer0Max:4365}]}},W2:{JPN:{nazo:[34187516,33790709,3565e4,35650084,35650084],vcountTimerRanges:[{vcount:130,timer0Min:4341,timer0Max:4347}]},KOR:{nazo:[34190892,33793281,35653488,35653572,35653572],vcountTimerRanges:[{vcount:129,timer0Min:4324,timer0Max:4329}]},USA:{nazo:[34189096,33791509,35651664,35651748,35651748],vcountTimerRanges:[{vcount:130,timer0Min:4338,timer0Max:4342}]},GER:{nazo:[34188872,33791381,35651440,35651524,35651524],vcountTimerRanges:[{vcount:130,timer0Min:4325,timer0Max:4333}]},FRA:{nazo:[34189096,33791525,35651664,35651748,35651748],vcountTimerRanges:[{vcount:130,timer0Min:4332,timer0Max:4336}]},SPA:{nazo:[34189e3,33791461,35651568,35651652,35651652],vcountTimerRanges:[{vcount:130,timer0Min:4335,timer0Max:4340}]},ITA:{nazo:[34188840,33791381,35651408,35651492,35651492],vcountTimerRanges:[{vcount:130,timer0Min:4351,timer0Max:4356}]}}},o={params:null,running:!1,stopRequested:!1,isPaused:!1,pauseResolve:null};function ae(e,t,n){return new e.DSConfigJs(new Uint8Array(t.macAddress),new Uint32Array(n),t.hardware)}function re(e,t,n,s){return new e.SegmentParamsJs(t,n,s)}function ie(e,t){return new e.TimeRangeParamsJs(t.hour.start,t.hour.end,t.minute.start,t.minute.end,t.second.start,t.second.end)}function ce(e,t,n){const s=t.getHours()*3600+t.getMinutes()*60+t.getSeconds();return new e.SearchRangeParamsJs(t.getFullYear(),t.getMonth()+1,t.getDate(),s,n)}const b=self,d=e=>b.postMessage(e);d({type:"READY",version:"1"});b.onmessage=e=>{const t=e.data;(async()=>{try{switch(t.type){case"START_SEARCH":await le(t.params);break;case"PAUSE":ue();break;case"RESUME":me();break;case"STOP":o.stopRequested=!0,o.isPaused&&o.pauseResolve&&(o.pauseResolve(),o.pauseResolve=null,o.isPaused=!1);break;default:break}}catch(n){const s=n instanceof Error?n.message:String(n);d({type:"ERROR",message:s,category:"RUNTIME",fatal:!1})}})()};function ue(){!o.running||o.isPaused||(o.isPaused=!0,d({type:"PROGRESS",payload:de()}))}function me(){!o.running||!o.isPaused||(o.isPaused=!1,o.pauseResolve&&(o.pauseResolve(),o.pauseResolve=null))}function de(){return{processedCombinations:0,totalCombinations:0,foundCount:0,progressPercent:0,elapsedMs:0,estimatedRemainingMs:0}}async function B(){await new Promise(e=>setTimeout(e,0)),o.isPaused&&await new Promise(e=>{o.pauseResolve=e})}async function le(e){if(o.running)return;o.params=e,o.stopRequested=!1,o.running=!0;const t=performance.now();try{await ge();const n=await fe(e,t),s={reason:o.stopRequested?"stopped":"completed",processedCombinations:n.processedSegments,totalCombinations:n.totalSegments,resultsCount:n.resultsCount,elapsedMs:performance.now()-t};d({type:"COMPLETE",payload:s})}catch(n){const s=n instanceof Error?n.message:String(n);d({type:"ERROR",message:s,category:"RUNTIME",fatal:!0})}finally{G()}}async function ge(){oe()||await te()}function Re(e,t){const n=se[e];if(!n)throw new Error(`Unknown ROM version: ${e}`);const s=n[t];if(!s)throw new Error(`Unknown region for ${e}: ${t}`);return s.nazo}function Se(e,t){return{boot:{datetime:new Date(e.year,e.month-1,e.day,e.hour,e.minute,e.second),timer0:e.timer0,vcount:e.vcount,keyCode:e.keyCode,keyInputNames:Z(e.keyCode),macAddress:t},mtSeedHex:e.mtSeedHex,mtSeed:e.mtSeed,lcgSeedHex:e.lcgSeedHex}}async function fe(e,t){const s=ne();if(!s.MtSeedBootTimingSearchIterator)throw new Error("MtSeedBootTimingSearchIterator not exposed in WASM");const T=Re(e.romVersion,e.romRegion),a=ee(e.keyInputMask),{dateRange:r}=e,l=new Date(r.startYear,r.startMonth-1,r.startDay);let R;if(e.rangeSeconds!==void 0)R=e.rangeSeconds;else{const f=new Date(r.endYear,r.endMonth-1,r.endDay);R=Math.max(1,Math.floor((f.getTime()-l.getTime())/(1e3*60*60*24))+1)*24*60*60}const O=e.timer0Range.max-e.timer0Range.min+1,U=e.vcountRange.max-e.vcountRange.min+1,S=O*U*a.length,P=S*R,D=4,_=3600*24*5*S,K=500;let i=0,g=0,z=0,k=t;const W=new Uint32Array(e.targetSeeds);for(let f=e.timer0Range.min;f<=e.timer0Range.max&&i<e.maxResults;f++)for(let p=e.vcountRange.min;p<=e.vcountRange.max&&i<e.maxResults;p++)for(const Y of a){if(await B(),o.stopRequested||i>=e.maxResults)return{resultsCount:i,processedSegments:g,totalSegments:S};const L=ae(s,e,T),j=re(s,f,p,Y),q=ie(s,e.timeRange),H=ce(s,l,R);let y;try{y=new s.MtSeedBootTimingSearchIterator(L,j,q,H,W)}catch(M){console.error("Failed to create MtSeedBootTimingSearchIterator:",M),g++;continue}try{let M=0;for(;!y.isFinished&&i<e.maxResults&&(await B(),!o.stopRequested);){const E=y.next_batch(D,_).to_array();if(M=Math.min(M+_,R),E.length>0){const v=[];for(let c=0;c<E.length&&i<e.maxResults;c++){const I=E[c];v.push(Se(I,e.macAddress)),i++}d({type:"RESULTS",payload:{results:v,batchIndex:g}})}const x=performance.now();if(x-k>=K){const v=x-t,c=z+M,I=P>0?c/P*100:0,V=c>0?v/c*(P-c):0;d({type:"PROGRESS",payload:{processedCombinations:g,totalCombinations:S,foundCount:i,progressPercent:I,elapsedMs:v,estimatedRemainingMs:V,processedSeconds:c}}),k=x}}}finally{y.free?.()}z+=R,g++}const F=performance.now()-t;return d({type:"PROGRESS",payload:{processedCombinations:g,totalCombinations:S,foundCount:i,progressPercent:100,elapsedMs:F,estimatedRemainingMs:0}}),{resultsCount:i,processedSegments:g,totalSegments:S}}function G(){o.running=!1,o.params=null,o.stopRequested=!1,o.isPaused=!1,o.pauseResolve=null}b.onclose=()=>{G()};
