const b=[["A",0],["B",1],["Select",2],["Start",3],["[→]",4],["[←]",5],["[↑]",6],["[↓]",7],["R",8],["L",9],["X",10],["Y",11]],u=b.reduce((e,[n,t])=>(e[n]=t,e),{}),N=b.length,B=(1<<N)-1,A=12287,$=[1<<u["[↑]"]|1<<u["[↓]"],1<<u["[←]"]|1<<u["[→]"],1<<u.Select|1<<u.Start|1<<u.L|1<<u.R];function z(e,n){return Number.isFinite(e)?n==="mask"?e&B:(e&A^A)&B:0}function X(e){const n=[];for(const[t,o]of b)(e&1<<o)!==0&&n.push(t);return n}function j(e){const n=z(e,"mask");for(const t of $)if((n&t)===t)return!0;return!1}function Q(e){const n=z(e,"code");return X(n)}function Z(e){const n=z(e,"mask"),t=[];for(let s=0;s<N;s+=1)(n&1<<s)!==0&&t.push(s);const o=[],p=1<<t.length;for(let s=0;s<p;s+=1){let a=0;for(let g=0;g<t.length;g+=1)(s&1<<g)!==0&&(a|=1<<t[g]);j(a)||o.push((a^A)>>>0)}return o}let m=null,y=null;async function ee(){return m||y||(y=(async()=>{try{const e=await import("./wasm_pkg-DoV9kKKf.js");let n;if(typeof process<"u"&&!!process.versions?.node){const o=await import("./__vite-browser-external-9wXp6ZBx.js"),s=(await import("./__vite-browser-external-9wXp6ZBx.js")).join(process.cwd(),"src/wasm/wasm_pkg_bg.wasm");n={module_or_path:o.readFileSync(s)}}else n={module_or_path:new URL("/pokemon-gen5-initseed/assets/wasm_pkg_bg-B52NXIxA.wasm",import.meta.url)};return await e.default(n),m={BWGenerationConfig:e.BWGenerationConfig,PokemonGenerator:e.PokemonGenerator,SeedEnumerator:e.SeedEnumerator,EncounterType:e.EncounterType,GameVersion:e.GameVersion,GameMode:e.GameMode,EggSeedEnumeratorJs:e.EggSeedEnumeratorJs,ParentsIVsJs:e.ParentsIVsJs,GenerationConditionsJs:e.GenerationConditionsJs,EverstonePlanJs:e.EverstonePlanJs,IndividualFilterJs:e.IndividualFilterJs,TrainerIds:e.TrainerIds,GenderRatio:e.GenderRatio,StatRange:e.StatRange,EggBootTimingSearchResult:e.EggBootTimingSearchResult,EggBootTimingSearchIterator:e.EggBootTimingSearchIterator,DSConfigJs:e.DSConfigJs,SegmentParamsJs:e.SegmentParamsJs,TimeRangeParamsJs:e.TimeRangeParamsJs,SearchRangeParamsJs:e.SearchRangeParamsJs,IVBootTimingSearchIterator:e.IVBootTimingSearchIterator,IVBootTimingSearchResult:e.IVBootTimingSearchResult,IVBootTimingSearchResults:e.IVBootTimingSearchResults,calculate_game_offset:e.calculate_game_offset,sha1_hash_batch:e.sha1_hash_batch},m}catch(e){throw console.error("Failed to load WebAssembly module:",e),m=null,y=null,e}})(),y)}function ne(){if(!m)throw new Error("WebAssembly module not initialized. Call initWasm() first.");return m}function te(){return m!==null}const oe={B:{JPN:{nazo:[35741456,35741708,35741708,35741784,35741784],vcountTimerRanges:[[96,3193,3194]]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[[96,3204,3205]]},USA:{nazo:[35741872,35742124,35742124,35742200,35742200],vcountTimerRanges:[[96,3195,3196]]},GER:{nazo:[35741680,35741932,35741932,35742008,35742008],vcountTimerRanges:[[95,3191,3192]]},FRA:{nazo:[35741744,35741996,35741996,35742072,35742072],vcountTimerRanges:[[95,3187,3188]]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[[96,3206,3207]]},ITA:{nazo:[35741616,35741868,35741868,35741944,35741944],vcountTimerRanges:[[95,3178,3179]]}},W:{JPN:{nazo:[35741488,35741740,35741740,35741816,35741816],vcountTimerRanges:[[95,3175,3177]]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[[96,3195,3196]]},USA:{nazo:[35741904,35742156,35742156,35742232,35742232],vcountTimerRanges:[[96,3198,3200]]},GER:{nazo:[35741712,35741964,35741964,35742040,35742040],vcountTimerRanges:[[96,3194,3195]]},FRA:{nazo:[35741776,35742028,35742028,35742104,35742104],vcountTimerRanges:[[95,3182,3183]]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[[95,3184,3185]]},ITA:{nazo:[35741648,35741900,35741900,35741976,35741976],vcountTimerRanges:[[96,3195,3196]]}},B2:{JPN:{nazo:[34187484,33790665,35649968,35650052,35650052],vcountTimerRanges:[[130,4354,4360]]},KOR:{nazo:[34190860,33793237,35653456,35653540,35653540],vcountTimerRanges:[[130,4335,4340]]},USA:{nazo:[34189032,33791465,35651600,35651684,35651684],vcountTimerRanges:[[130,4354,4360]]},GER:{nazo:[34188840,33791337,35651408,35651492,35651492],vcountTimerRanges:[[129,4325,4328],[130,4329,4332]]},FRA:{nazo:[34189064,33791481,35651632,35651716,35651716],vcountTimerRanges:[[130,4340,4344]]},SPA:{nazo:[34188968,33791417,35651536,35651620,35651620],vcountTimerRanges:[[130,4353,4358]]},ITA:{nazo:[34188776,33791337,35651344,35651428,35651428],vcountTimerRanges:[[130,4359,4361],[131,4361,4365]]}},W2:{JPN:{nazo:[34187516,33790709,3565e4,35650084,35650084],vcountTimerRanges:[[130,4341,4347]]},KOR:{nazo:[34190892,33793281,35653488,35653572,35653572],vcountTimerRanges:[[129,4324,4329]]},USA:{nazo:[34189096,33791509,35651664,35651748,35651748],vcountTimerRanges:[[130,4338,4342]]},GER:{nazo:[34188872,33791381,35651440,35651524,35651524],vcountTimerRanges:[[130,4325,4333]]},FRA:{nazo:[34189096,33791525,35651664,35651748,35651748],vcountTimerRanges:[[130,4332,4336]]},SPA:{nazo:[34189e3,33791461,35651568,35651652,35651652],vcountTimerRanges:[[130,4335,4340]]},ITA:{nazo:[34188840,33791381,35651408,35651492,35651492],vcountTimerRanges:[[130,4351,4356]]}}},r={params:null,running:!1,stopRequested:!1};function se(e,n,t){return new e.DSConfigJs(new Uint8Array(n.macAddress),new Uint32Array(t),n.hardware)}function ae(e,n,t,o){return new e.SegmentParamsJs(n,t,o)}function re(e,n){return new e.TimeRangeParamsJs(n.hour.start,n.hour.end,n.minute.start,n.minute.end,n.second.start,n.second.end)}function ie(e,n,t){return new e.SearchRangeParamsJs(n.getFullYear(),n.getMonth()+1,n.getDate(),t)}const _=self,d=e=>_.postMessage(e);d({type:"READY",version:"1"});_.onmessage=e=>{const n=e.data;(async()=>{try{switch(n.type){case"START_SEARCH":await ce(n.params);break;case"STOP":r.stopRequested=!0;break;default:break}}catch(t){const o=t instanceof Error?t.message:String(t);d({type:"ERROR",message:o,category:"RUNTIME",fatal:!1})}})()};async function ce(e){if(r.running)return;r.params=e,r.stopRequested=!1,r.running=!0;const n=performance.now();try{await ue();const t=await le(e,n),o={reason:r.stopRequested?"stopped":"completed",processedCombinations:t.processedSegments,totalCombinations:t.totalSegments,resultsCount:t.resultsCount,elapsedMs:performance.now()-n};d({type:"COMPLETE",payload:o})}catch(t){const o=t instanceof Error?t.message:String(t);d({type:"ERROR",message:o,category:"RUNTIME",fatal:!0})}finally{x()}}async function ue(){te()||await ee()}function me(e,n){const t=oe[e];if(!t)throw new Error(`Unknown ROM version: ${e}`);const o=t[n];if(!o)throw new Error(`Unknown region for ${e}: ${n}`);return o.nazo}function ge(e,n){return{boot:{datetime:new Date(Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second)),timer0:e.timer0,vcount:e.vcount,keyCode:e.keyCode,keyInputNames:Q(e.keyCode),macAddress:n},mtSeedHex:e.mtSeedHex,mtSeed:e.mtSeed,lcgSeedHex:e.lcgSeedHex}}async function le(e,n){const o=ne();if(!o.IVBootTimingSearchIterator)throw new Error("IVBootTimingSearchIterator not exposed in WASM");const p=me(e.romVersion,e.romRegion),s=Z(e.keyInputMask),{dateRange:a}=e,g=new Date(a.startYear,a.startMonth-1,a.startDay);let R;if(e.rangeSeconds!==void 0)R=e.rangeSeconds;else{const S=new Date(a.endYear,a.endMonth-1,a.endDay);R=Math.max(1,Math.floor((S.getTime()-g.getTime())/(1e3*60*60*24))+1)*24*60*60}const D=e.timer0Range.max-e.timer0Range.min+1,G=e.vcountRange.max-e.vcountRange.min+1,f=D*G*s.length,v=f*R,O=4,M=3600*24*5*f,U=500;let i=0,l=0,k=0,J=n;const V=new Uint32Array(e.targetSeeds);for(let S=e.timer0Range.min;S<=e.timer0Range.max&&i<e.maxResults;S++)for(let I=e.vcountRange.min;I<=e.vcountRange.max&&i<e.maxResults;I++)for(const W of s){if(r.stopRequested||i>=e.maxResults)return{resultsCount:i,processedSegments:l,totalSegments:f};const F=se(o,e,p),Y=ae(o,S,I,W),L=re(o,e.timeRange),q=ie(o,g,R);let E;try{E=new o.IVBootTimingSearchIterator(F,Y,L,q,V)}catch(T){console.error("Failed to create IVBootTimingSearchIterator:",T),l++;continue}try{let T=0;for(;!E.isFinished&&i<e.maxResults&&!r.stopRequested;){const C=E.next_batch(O,M).to_array();if(T=Math.min(T+M,R),C.length>0){const h=[];for(let c=0;c<C.length&&i<e.maxResults;c++){const w=C[c];h.push(ge(w,e.macAddress)),i++}d({type:"RESULTS",payload:{results:h,batchIndex:l}})}const P=performance.now();if(P-J>=U){const h=P-n,c=k+T,w=v>0?c/v*100:0,H=c>0?h/c*(v-c):0;d({type:"PROGRESS",payload:{processedCombinations:l,totalCombinations:f,foundCount:i,progressPercent:w,elapsedMs:h,estimatedRemainingMs:H,processedSeconds:c}}),J=P}}}finally{E.free?.()}k+=R,l++}const K=performance.now()-n;return d({type:"PROGRESS",payload:{processedCombinations:l,totalCombinations:f,foundCount:i,progressPercent:100,elapsedMs:K,estimatedRemainingMs:0}}),{resultsCount:i,processedSegments:l,totalSegments:f}}function x(){r.running=!1,r.params=null,r.stopRequested=!1}_.onclose=()=>{x()};
