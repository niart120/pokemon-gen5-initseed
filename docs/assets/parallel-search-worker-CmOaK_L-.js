var U=Object.defineProperty;var H=(t,e,a)=>e in t?U(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var b=(t,e,a)=>H(t,typeof e!="symbol"?e+"":e,a);class W{calculateHash(e){if(e.length!==16)throw new Error("Message must be exactly 16 32-bit words (64 bytes)");const a=1732584193,o=4023233417,s=2562383102,u=271733878,n=3285377520,l=new Array(80);for(let i=0;i<16;i++)l[i]=e[i];for(let i=16;i<80;i++)l[i]=this.leftRotate(l[i-3]^l[i-8]^l[i-14]^l[i-16],1);let m=a,g=o,d=s,h=u,R=n;for(let i=0;i<80;i++){let C;i<20?C=this.leftRotate(m,5)+(g&d|~g&h)+R+l[i]+1518500249&4294967295:i<40?C=this.leftRotate(m,5)+(g^d^h)+R+l[i]+1859775393&4294967295:i<60?C=this.leftRotate(m,5)+(g&d|g&h|d&h)+R+l[i]+2400959708&4294967295:C=this.leftRotate(m,5)+(g^d^h)+R+l[i]+3395469782&4294967295,R=h,h=d,d=this.leftRotate(g,30),g=m,m=C}let T=this.add32(a,m),k=this.add32(o,g),f=this.add32(s,d),w=this.add32(u,h),I=this.add32(n,R);return{h0:T,h1:k,h2:f,h3:w,h4:I}}leftRotate(e,a){return(e<<a|e>>>32-a)>>>0}add32(e,a){return(e+a&4294967295)>>>0}static hashToHex(e,a,o,s,u){return e.toString(16).padStart(8,"0")+a.toString(16).padStart(8,"0")+o.toString(16).padStart(8,"0")+s.toString(16).padStart(8,"0")+u.toString(16).padStart(8,"0")}}let E=null,A=null;async function L(){return E||A||(A=(async()=>{try{const t=await import("./wasm_pkg-iOL440G_.js");return await t.default(),E={IntegratedSeedSearcher:t.IntegratedSeedSearcher},E}catch(t){throw console.error("Failed to load WebAssembly module:",t),E=null,A=null,t}})(),A)}function x(){if(!E)throw new Error("WebAssembly module not initialized. Call initWasm() first.");return E}function V(){return E!==null}const $={B:{JPN:{nazo:[35741456,35741708,35741708,35741784,35741784],vcountTimerRanges:[[96,3193,3194]]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[[96,3204,3205]]},USA:{nazo:[35741872,35742124,35742124,35742200,35742200],vcountTimerRanges:[[96,3195,3196]]},GER:{nazo:[35741680,35741932,35741932,35742008,35742008],vcountTimerRanges:[[95,3191,3192]]},FRA:{nazo:[35741744,35741996,35741996,35742072,35742072],vcountTimerRanges:[[95,3187,3188]]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[[96,3206,3207]]},ITA:{nazo:[35741616,35741868,35741868,35741944,35741944],vcountTimerRanges:[[95,3178,3179]]}},W:{JPN:{nazo:[35741488,35741740,35741740,35741816,35741816],vcountTimerRanges:[[95,3175,3177]]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[[96,3195,3196]]},USA:{nazo:[35741904,35742156,35742156,35742232,35742232],vcountTimerRanges:[[96,3198,3200]]},GER:{nazo:[35741712,35741964,35741964,35742040,35742040],vcountTimerRanges:[[96,3194,3195]]},FRA:{nazo:[35741776,35742028,35742028,35742104,35742104],vcountTimerRanges:[[95,3182,3183]]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[[95,3184,3185]]},ITA:{nazo:[35741648,35741900,35741900,35741976,35741976],vcountTimerRanges:[[96,3195,3196]]}},B2:{JPN:{nazo:[34187484,33790665,35649968,35650052,35650052],vcountTimerRanges:[[130,4354,4360]]},KOR:{nazo:[34190860,33793237,35653456,35653540,35653540],vcountTimerRanges:[[130,4335,4340]]},USA:{nazo:[34189032,33791465,35651600,35651684,35651684],vcountTimerRanges:[[130,4354,4360]]},GER:{nazo:[34188840,33791337,35651408,35651492,35651492],vcountTimerRanges:[[129,4325,4328],[130,4329,4332]]},FRA:{nazo:[34189064,33791481,35651632,35651716,35651716],vcountTimerRanges:[[130,4340,4344]]},SPA:{nazo:[34188968,33791417,35651536,35651620,35651620],vcountTimerRanges:[[130,4353,4358]]},ITA:{nazo:[34188776,33791337,35651344,35651428,35651428],vcountTimerRanges:[[130,4359,4361],[131,4361,4365]]}},W2:{JPN:{nazo:[34187516,33790709,3565e4,35650084,35650084],vcountTimerRanges:[[130,4341,4347]]},KOR:{nazo:[34190892,33793281,35653488,35653572,35653572],vcountTimerRanges:[[129,4324,4329]]},USA:{nazo:[34189096,33791509,35651664,35651748,35651748],vcountTimerRanges:[[130,4338,4342]]},GER:{nazo:[34188872,33791381,35651440,35651524,35651524],vcountTimerRanges:[[130,4325,4333]]},FRA:{nazo:[34189096,33791525,35651664,35651748,35651748],vcountTimerRanges:[[130,4332,4336]]},SPA:{nazo:[34189e3,33791461,35651568,35651652,35651652],vcountTimerRanges:[[130,4335,4340]]},ITA:{nazo:[34188840,33791381,35651408,35651492,35651492],vcountTimerRanges:[[130,4351,4356]]}}},_={DS:8,DS_LITE:6,"3DS":9};class B{constructor(){b(this,"sha1");b(this,"useWasm",!1);this.sha1=new W}async initializeWasm(){try{return await L(),this.useWasm=!0,!0}catch(e){return console.warn("WebAssembly initialization failed, falling back to TypeScript:",e),this.useWasm=!1,!1}}isUsingWasm(){return this.useWasm&&V()}getWasmModule(){return x()}setUseWasm(e){if(e&&!V()){console.warn("Cannot enable WebAssembly: module not initialized");return}this.useWasm=e}getROMParameters(e,a){const o=$[e];if(!o)return console.error(`ROM version not found: ${e}`),null;const s=o[a];return s?{nazo:[...s.nazo],vcountTimerRanges:s.vcountTimerRanges.map(u=>[...u])}:(console.error(`ROM region not found: ${a} for version ${e}`),null)}toLittleEndian32(e){return((e&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255)>>>0}toLittleEndian16(e){return(e&255)<<8|e>>>8&255}getDayOfWeek(e,a,o){return new Date(e,a-1,o).getDay()}generateMessage(e,a,o,s){const u=this.getROMParameters(e.romVersion,e.romRegion);if(!u)throw new Error(`No parameters found for ${e.romVersion} ${e.romRegion}`);const n=new Array(16).fill(0);for(let P=0;P<5;P++)n[P]=this.toLittleEndian32(u.nazo[P]);n[5]=this.toLittleEndian32(o<<16|a);const l=e.macAddress[4]<<8|e.macAddress[5];n[6]=l;const m=e.macAddress[0]<<0|e.macAddress[1]<<8|e.macAddress[2]<<16|e.macAddress[3]<<24,g=100663296,d=_[e.hardware],h=m^g^d;n[7]=this.toLittleEndian32(h);const R=s.getFullYear()%100,T=s.getMonth()+1,k=s.getDate(),f=this.getDayOfWeek(s.getFullYear(),T,k),w=Math.floor(R/10)*16+R%10,I=Math.floor(T/10)*16+T%10,i=Math.floor(k/10)*16+k%10,C=Math.floor(f/10)*16+f%10;n[8]=w<<24|I<<16|i<<8|C;const y=s.getHours(),c=s.getMinutes(),M=s.getSeconds(),D=(e.hardware==="DS"||e.hardware==="DS_LITE")&&y>=12?1:0,z=Math.floor(y/10)*16+y%10,O=Math.floor(c/10)*16+c%10,F=Math.floor(M/10)*16+M%10;return n[9]=D<<30|z<<24|O<<16|F<<8|0,n[10]=0,n[11]=0,n[12]=this.toLittleEndian32(e.keyInput),n[13]=2147483648,n[14]=0,n[15]=416,n}calculateSeed(e){const a=this.sha1.calculateHash(e),o=BigInt(this.toLittleEndian32(a.h0)),m=(BigInt(this.toLittleEndian32(a.h1))<<32n|o)*0x5D588B656C078965n+0x269EC3n;return{seed:Number(m>>32n&0xFFFFFFFFn),hash:W.hashToHex(a.h0,a.h1,a.h2,a.h3,a.h4)}}parseTargetSeeds(e){const a=e.split(`
`).map(n=>n.trim()).filter(n=>n.length>0),o=[],s=[],u=new Set;return a.forEach((n,l)=>{try{let m=n.toLowerCase();if(m.startsWith("0x")&&(m=m.substring(2)),!/^[0-9a-f]{1,8}$/.test(m)){s.push({line:l+1,value:n,error:"Invalid hexadecimal format. Expected 1-8 hex digits."});return}const g=parseInt(m,16);if(u.has(g))return;u.add(g),o.push(g)}catch{s.push({line:l+1,value:n,error:"Failed to parse as hexadecimal number."})}}),{validSeeds:o,errors:s}}getVCountForTimer0(e,a){for(const[o,s,u]of e.vcountTimerRanges)if(a>=s&&a<=u)return o;return e.vcountTimerRanges.length>0?e.vcountTimerRanges[0][0]:96}}let r={isRunning:!1,isPaused:!1,shouldStop:!1,workerId:-1,chunk:null,startTime:0},S={cumulativeRunTime:0,segmentStartTime:0,isPaused:!1},p;function N(){S.cumulativeRunTime=0,S.segmentStartTime=Date.now(),S.isPaused=!1}function G(){S.isPaused||(S.cumulativeRunTime+=Date.now()-S.segmentStartTime,S.isPaused=!0)}function J(){S.isPaused&&(S.segmentStartTime=Date.now(),S.isPaused=!1)}function K(){return S.isPaused?S.cumulativeRunTime:S.cumulativeRunTime+(Date.now()-S.segmentStartTime)}async function Y(){if(!p){p=new B;try{await p.initializeWasm()}catch(t){console.warn(`Worker ${r.workerId}: WebAssembly failed, using TypeScript fallback:`,t)}}}async function q(t,e){if(!r.chunk)throw new Error("No chunk assigned to worker");r.startTime=Date.now();let a=0;try{if(p.isUsingWasm()){const o=await Z(t,e);a=o.length;for(const s of o)postMessage({type:"RESULT",workerId:r.workerId,result:{...s,datetime:s.datetime.toISOString()}})}else a=await j(t,e);postMessage({type:"COMPLETE",workerId:r.workerId,message:`Worker ${r.workerId} completed with ${a} matches`})}catch(o){console.error(`‚ùå Worker ${r.workerId}: Processing error:`,o),postMessage({type:"ERROR",workerId:r.workerId,error:o instanceof Error?o.message:"Unknown error"})}}async function Z(t,e){const a=p.getWasmModule(),o=p.getROMParameters(t.romVersion,t.romRegion);if(!o)throw new Error(`No ROM parameters found for ${t.romVersion} ${t.romRegion}`);const u={DS:8,DS_LITE:6,"3DS":9}[t.hardware]||8,n=new a.IntegratedSeedSearcher(t.macAddress,new Uint32Array(o.nazo),t.hardware,t.keyInput,u);try{const l=r.chunk,m=l.startDateTime,g=l.endDateTime,d=Math.floor((g.getTime()-m.getTime())/1e3)+1,h=d*(t.timer0VCountConfig.timer0Range.max-t.timer0VCountConfig.timer0Range.min+1)*(t.timer0VCountConfig.vcountRange.max-t.timer0VCountConfig.vcountRange.min+1);v(0,h,0);const R=Math.min(7200*60,d),T=[];let k=0;for(let f=0;f<d&&!r.shouldStop;f+=R){if(r.isPaused){for(postMessage({type:"PAUSED",workerId:r.workerId});r.isPaused&&!r.shouldStop;)await new Promise(c=>setTimeout(c,100));r.shouldStop||postMessage({type:"RESUMED",workerId:r.workerId})}if(r.shouldStop)break;const w=new Date(m.getTime()+f*1e3),I=new Date(Math.min(m.getTime()+(f+R)*1e3,g.getTime()+1e3)),i=Math.floor((I.getTime()-w.getTime())/1e3);if(i<=0)break;if(await new Promise(c=>setTimeout(c,0)),r.isPaused){for(;r.isPaused&&!r.shouldStop;)await new Promise(c=>setTimeout(c,100));if(r.shouldStop)break}const C=n.search_seeds_integrated_simd(w.getFullYear(),w.getMonth()+1,w.getDate(),w.getHours(),w.getMinutes(),w.getSeconds(),i,t.timer0VCountConfig.timer0Range.min,t.timer0VCountConfig.timer0Range.max,t.timer0VCountConfig.vcountRange.min,t.timer0VCountConfig.vcountRange.max,new Uint32Array(e));await new Promise(c=>setTimeout(c,0));for(const c of C){const M=new Date(c.year,c.month-1,c.date,c.hour,c.minute,c.second),D=p.generateMessage(t,c.timer0,c.vcount,M),{hash:z}=p.calculateSeed(D);T.push({seed:c.seed,datetime:M,timer0:c.timer0,vcount:c.vcount,conditions:t,message:D,sha1Hash:z,isMatch:!0})}const y=i*(t.timer0VCountConfig.timer0Range.max-t.timer0VCountConfig.timer0Range.min+1)*(t.timer0VCountConfig.vcountRange.max-t.timer0VCountConfig.vcountRange.min+1);k+=y,v(k,h,T.length)}return T}finally{n.free()}}async function j(t,e){const a=r.chunk,o=new Set(e);let s=0,u=0;const n=p.getROMParameters(t.romVersion,t.romRegion);if(!n)throw new Error(`No ROM parameters found for ${t.romVersion} ${t.romRegion}`);const l=a.startDateTime.getTime(),m=a.endDateTime.getTime(),d=(Math.floor((m-l)/1e3)+1)*(t.timer0VCountConfig.timer0Range.max-t.timer0VCountConfig.timer0Range.min+1);for(let h=t.timer0VCountConfig.timer0Range.min;h<=t.timer0VCountConfig.timer0Range.max&&!r.shouldStop;h++){const R=p.getVCountForTimer0(n,h);for(let T=l;T<=m&&!r.shouldStop;T+=1e3){for(;r.isPaused&&!r.shouldStop;)await new Promise(f=>setTimeout(f,100));if(r.shouldStop)break;const k=new Date(T);try{const f=p.generateMessage(t,h,R,k),{seed:w,hash:I}=p.calculateSeed(f);if(o.has(w)){const i={seed:w,datetime:k,timer0:h,vcount:R,conditions:t,message:f,sha1Hash:I,isMatch:!0};postMessage({type:"RESULT",workerId:r.workerId,result:{...i,datetime:i.datetime.toISOString()}}),s++}if(u++,u%1e3===0){if(v(u,d,s),r.isPaused)for(;r.isPaused&&!r.shouldStop;)await new Promise(i=>setTimeout(i,100));await new Promise(i=>setTimeout(i,0))}}catch(f){console.error(`Worker ${r.workerId}: Error calculating seed:`,f)}}}return v(u,d,s),s}function v(t,e,a){var n;const o=K(),s=t/e,u=s>0?Math.round(o/s*(1-s)):0;postMessage({type:"PROGRESS",workerId:r.workerId,progress:{currentStep:t,totalSteps:e,elapsedTime:o,estimatedTimeRemaining:u,matchesFound:a,currentDateTime:(n=r.chunk)==null?void 0:n.startDateTime.toISOString()}})}self.onmessage=async t=>{const{type:e,conditions:a,targetSeeds:o,workerId:s,chunk:u}=t.data;switch(s!==void 0&&(r.workerId=s),e){case"START_SEARCH":if(!a||!o||!u){postMessage({type:"ERROR",workerId:r.workerId,error:"Missing required parameters for search"});return}r.chunk=u,r.isRunning=!0,r.shouldStop=!1,r.isPaused=!1,N();try{await Y(),await q(a,o)}catch(n){postMessage({type:"ERROR",workerId:r.workerId,error:n instanceof Error?n.message:"Unknown error"})}finally{r.isRunning=!1}break;case"PAUSE_SEARCH":r.isPaused=!0,G(),postMessage({type:"PAUSED",workerId:r.workerId});break;case"RESUME_SEARCH":r.isPaused=!1,J(),postMessage({type:"RESUMED",workerId:r.workerId});break;case"STOP_SEARCH":r.shouldStop=!0,r.isRunning=!1,postMessage({type:"STOPPED",workerId:r.workerId});break;case"PING":postMessage({type:"INITIALIZED",workerId:r.workerId,message:`Pong from worker ${r.workerId}`});break}};postMessage({type:"READY",workerId:r.workerId,message:`Parallel worker ${r.workerId} initialized`});
