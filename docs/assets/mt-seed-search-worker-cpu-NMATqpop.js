function I(e){return[e>>25&31,e>>20&31,e>>15&31,e>>10&31,e>>5&31,e&31]}let o=null,c=null;async function k(){return o||c||(c=(async()=>{try{const e=await import("./wasm_pkg-DkL6Qplp.js");let t;if(typeof process<"u"&&!!process.versions?.node){const n=await import("./__vite-browser-external-9wXp6ZBx.js"),h=(await import("./__vite-browser-external-9wXp6ZBx.js")).join(process.cwd(),"src/wasm/wasm_pkg_bg.wasm");t={module_or_path:n.readFileSync(h)}}else t={module_or_path:new URL("/pokemon-gen5-initseed/assets/wasm_pkg_bg-DkPxcpUG.wasm",import.meta.url)};return await e.default(t),o={BWGenerationConfig:e.BWGenerationConfig,PokemonGenerator:e.PokemonGenerator,SeedEnumerator:e.SeedEnumerator,EncounterType:e.EncounterType,GameVersion:e.GameVersion,GameMode:e.GameMode,EggSeedEnumeratorJs:e.EggSeedEnumeratorJs,ParentsIVsJs:e.ParentsIVsJs,GenerationConditionsJs:e.GenerationConditionsJs,EverstonePlanJs:e.EverstonePlanJs,IndividualFilterJs:e.IndividualFilterJs,TrainerIds:e.TrainerIds,GenderRatio:e.GenderRatio,StatRange:e.StatRange,EggBootTimingSearchResult:e.EggBootTimingSearchResult,EggBootTimingSearchIterator:e.EggBootTimingSearchIterator,DSConfigJs:e.DSConfigJs,SegmentParamsJs:e.SegmentParamsJs,TimeRangeParamsJs:e.TimeRangeParamsJs,SearchRangeParamsJs:e.SearchRangeParamsJs,MtSeedBootTimingSearchIterator:e.MtSeedBootTimingSearchIterator,MtSeedBootTimingSearchResult:e.MtSeedBootTimingSearchResult,MtSeedBootTimingSearchResults:e.MtSeedBootTimingSearchResults,calculate_game_offset:e.calculate_game_offset,sha1_hash_batch:e.sha1_hash_batch,mt_seed_search_segment:e.mt_seed_search_segment},o}catch(e){throw console.error("Failed to load WebAssembly module:",e),o=null,c=null,e}})(),c)}function A(){if(!o)throw new Error("WebAssembly module not initialized. Call initWasm() first.");return o}function B(){return o!==null}const s={job:null,running:!1,stopRequested:!1,isPaused:!1,pauseResolve:null},w=self,r=e=>w.postMessage(e);r({type:"READY",version:"1"});w.onmessage=e=>{const t=e.data;(async()=>{try{switch(t.type){case"START":await q(t.job);break;case"PAUSE":W();break;case"RESUME":U();break;case"STOP":s.stopRequested=!0,s.isPaused&&s.pauseResolve&&(s.pauseResolve(),s.pauseResolve=null,s.isPaused=!1);break;default:break}}catch(a){const n=a instanceof Error?a.message:String(a);r({type:"ERROR",message:n,category:"RUNTIME"})}})()};function W(){!s.running||s.isPaused||(s.isPaused=!0)}function U(){!s.running||!s.isPaused||(s.isPaused=!1,s.pauseResolve&&(s.pauseResolve(),s.pauseResolve=null))}async function O(){await new Promise(e=>setTimeout(e,0)),s.isPaused&&await new Promise(e=>{s.pauseResolve=e})}async function q(e){if(s.running)return;s.job=e,s.stopRequested=!1,s.running=!0;const t=performance.now();try{await F();const a=await V(e,t),n={reason:s.stopRequested?"stopped":"finished",totalProcessed:a.processedCount,totalMatches:a.matchesFound,elapsedMs:performance.now()-t};r({type:"COMPLETE",payload:n})}catch(a){const n=a instanceof Error?a.message:String(a);r({type:"ERROR",message:n,category:"RUNTIME"})}finally{v()}}async function F(){B()||await k()}const N=1048576,j=500;async function V(e,t){const n=A();if(!n.mt_seed_search_segment)throw new Error("mt_seed_search_segment not exposed in WASM");const{searchRange:y,ivCodes:h,mtAdvances:P,jobId:R}=e,{start:E,end:l}=y,M=new Uint32Array(h),_=l-E+1;let u=0,m=0,T=t,i=E;for(;i<=l&&(await O(),!s.stopRequested);){const d=Math.min(i+N-1,l),g=n.mt_seed_search_segment(i,d,P,M);if(g.length>0){const p=[];for(let f=0;f<g.length;f+=2){const C=g[f],b=g[f+1],G=I(b);p.push({mtSeed:C,ivCode:b,ivSet:G}),m++}r({type:"RESULTS",payload:{jobId:R,matches:p}})}u+=d-i+1;const S=performance.now();if(S-T>=j){const p={jobId:R,processedCount:u,totalCount:_,elapsedMs:S-t,matchesFound:m};r({type:"PROGRESS",payload:p}),T=S}if(d>=l)break;i=d+1}const J={jobId:R,processedCount:u,totalCount:_,elapsedMs:performance.now()-t,matchesFound:m};return r({type:"PROGRESS",payload:J}),{processedCount:u,matchesFound:m}}function v(){s.running=!1,s.job=null,s.stopRequested=!1,s.isPaused=!1,s.pauseResolve=null}w.onclose=()=>{v()};
