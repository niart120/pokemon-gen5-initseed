var v=(e=>(e[e.BwNew=0]="BwNew",e[e.BwContinue=1]="BwContinue",e[e.Bw2New=2]="Bw2New",e[e.Bw2Continue=3]="Bw2Continue",e))(v||{});let l=null,y=null;async function X(){return l||y||(y=(async()=>{try{const e=await import("./wasm_pkg-DoV9kKKf.js");let n;if(typeof process<"u"&&!!process.versions?.node){const o=await import("./__vite-browser-external-9wXp6ZBx.js"),s=(await import("./__vite-browser-external-9wXp6ZBx.js")).join(process.cwd(),"src/wasm/wasm_pkg_bg.wasm");n={module_or_path:o.readFileSync(s)}}else n={module_or_path:new URL("/pokemon-gen5-initseed/assets/wasm_pkg_bg-B52NXIxA.wasm",import.meta.url)};return await e.default(n),l={BWGenerationConfig:e.BWGenerationConfig,PokemonGenerator:e.PokemonGenerator,SeedEnumerator:e.SeedEnumerator,EncounterType:e.EncounterType,GameVersion:e.GameVersion,GameMode:e.GameMode,EggSeedEnumeratorJs:e.EggSeedEnumeratorJs,ParentsIVsJs:e.ParentsIVsJs,GenerationConditionsJs:e.GenerationConditionsJs,EverstonePlanJs:e.EverstonePlanJs,IndividualFilterJs:e.IndividualFilterJs,TrainerIds:e.TrainerIds,GenderRatio:e.GenderRatio,StatRange:e.StatRange,EggBootTimingSearchResult:e.EggBootTimingSearchResult,EggBootTimingSearchIterator:e.EggBootTimingSearchIterator,DSConfigJs:e.DSConfigJs,SegmentParamsJs:e.SegmentParamsJs,TimeRangeParamsJs:e.TimeRangeParamsJs,SearchRangeParamsJs:e.SearchRangeParamsJs,IVBootTimingSearchIterator:e.IVBootTimingSearchIterator,IVBootTimingSearchResult:e.IVBootTimingSearchResult,IVBootTimingSearchResults:e.IVBootTimingSearchResults,calculate_game_offset:e.calculate_game_offset,sha1_hash_batch:e.sha1_hash_batch},l}catch(e){throw console.error("Failed to load WebAssembly module:",e),l=null,y=null,e}})(),y)}function $(){if(!l)throw new Error("WebAssembly module not initialized. Call initWasm() first.");return l}function j(){return l!==null}const A=[["A",0],["B",1],["Select",2],["Start",3],["[→]",4],["[←]",5],["[↑]",6],["[↓]",7],["R",8],["L",9],["X",10],["Y",11]],g=A.reduce((e,[n,t])=>(e[n]=t,e),{}),M=A.length,J=(1<<M)-1,E=12287,Q=[1<<g["[↑]"]|1<<g["[↓]"],1<<g["[←]"]|1<<g["[→]"],1<<g.Select|1<<g.Start|1<<g.L|1<<g.R];function B(e,n){return Number.isFinite(e)?n==="mask"?e&J:(e&E^E)&J:0}function Z(e){const n=[];for(const[t,o]of A)(e&1<<o)!==0&&n.push(t);return n}function ee(e){const n=B(e,"mask");for(const t of Q)if((n&t)===t)return!0;return!1}function ne(e){const n=B(e,"code");return Z(n)}function te(e){const n=B(e,"mask"),t=[];for(let s=0;s<M;s+=1)(n&1<<s)!==0&&t.push(s);const o=[],i=1<<t.length;for(let s=0;s<i;s+=1){let r=0;for(let m=0;m<t.length;m+=1)(s&1<<m)!==0&&(r|=1<<t[m]);ee(r)||o.push((r^E)>>>0)}return o}const oe={B:{JPN:{nazo:[35741456,35741708,35741708,35741784,35741784],vcountTimerRanges:[[96,3193,3194]]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[[96,3204,3205]]},USA:{nazo:[35741872,35742124,35742124,35742200,35742200],vcountTimerRanges:[[96,3195,3196]]},GER:{nazo:[35741680,35741932,35741932,35742008,35742008],vcountTimerRanges:[[95,3191,3192]]},FRA:{nazo:[35741744,35741996,35741996,35742072,35742072],vcountTimerRanges:[[95,3187,3188]]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[[96,3206,3207]]},ITA:{nazo:[35741616,35741868,35741868,35741944,35741944],vcountTimerRanges:[[95,3178,3179]]}},W:{JPN:{nazo:[35741488,35741740,35741740,35741816,35741816],vcountTimerRanges:[[95,3175,3177]]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[[96,3195,3196]]},USA:{nazo:[35741904,35742156,35742156,35742232,35742232],vcountTimerRanges:[[96,3198,3200]]},GER:{nazo:[35741712,35741964,35741964,35742040,35742040],vcountTimerRanges:[[96,3194,3195]]},FRA:{nazo:[35741776,35742028,35742028,35742104,35742104],vcountTimerRanges:[[95,3182,3183]]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[[95,3184,3185]]},ITA:{nazo:[35741648,35741900,35741900,35741976,35741976],vcountTimerRanges:[[96,3195,3196]]}},B2:{JPN:{nazo:[34187484,33790665,35649968,35650052,35650052],vcountTimerRanges:[[130,4354,4360]]},KOR:{nazo:[34190860,33793237,35653456,35653540,35653540],vcountTimerRanges:[[130,4335,4340]]},USA:{nazo:[34189032,33791465,35651600,35651684,35651684],vcountTimerRanges:[[130,4354,4360]]},GER:{nazo:[34188840,33791337,35651408,35651492,35651492],vcountTimerRanges:[[129,4325,4328],[130,4329,4332]]},FRA:{nazo:[34189064,33791481,35651632,35651716,35651716],vcountTimerRanges:[[130,4340,4344]]},SPA:{nazo:[34188968,33791417,35651536,35651620,35651620],vcountTimerRanges:[[130,4353,4358]]},ITA:{nazo:[34188776,33791337,35651344,35651428,35651428],vcountTimerRanges:[[130,4359,4361],[131,4361,4365]]}},W2:{JPN:{nazo:[34187516,33790709,3565e4,35650084,35650084],vcountTimerRanges:[[130,4341,4347]]},KOR:{nazo:[34190892,33793281,35653488,35653572,35653572],vcountTimerRanges:[[129,4324,4329]]},USA:{nazo:[34189096,33791509,35651664,35651748,35651748],vcountTimerRanges:[[130,4338,4342]]},GER:{nazo:[34188872,33791381,35651440,35651524,35651524],vcountTimerRanges:[[130,4325,4333]]},FRA:{nazo:[34189096,33791525,35651664,35651748,35651748],vcountTimerRanges:[[130,4332,4336]]},SPA:{nazo:[34189e3,33791461,35651568,35651652,35651652],vcountTimerRanges:[[130,4335,4340]]},ITA:{nazo:[34188840,33791381,35651408,35651492,35651492],vcountTimerRanges:[[130,4351,4356]]}}},a={params:null,running:!1,stopRequested:!1};function re(e){switch(e){case v.BwNew:return 0;case v.BwContinue:return 2;case v.Bw2New:return 5;case v.Bw2Continue:return 7;default:return 2}}function se(e,n,t){return new e.DSConfigJs(new Uint8Array(n.macAddress),new Uint32Array(t),n.hardware)}function ie(e,n,t,o){return new e.SegmentParamsJs(n,t,o)}function ae(e,n){return new e.TimeRangeParamsJs(n.hour.start,n.hour.end,n.minute.start,n.minute.end,n.second.start,n.second.end)}function ce(e,n,t){return new e.SearchRangeParamsJs(n.getFullYear(),n.getMonth()+1,n.getDate(),t)}const k=self,f=e=>k.postMessage(e);f({type:"READY",version:"1"});k.onmessage=e=>{const n=e.data;(async()=>{try{switch(n.type){case"START_SEARCH":await de(n.params);break;case"STOP":a.stopRequested=!0;break;default:break}}catch(t){const o=t instanceof Error?t.message:String(t);f({type:"ERROR",message:o,category:"RUNTIME",fatal:!1})}})()};async function de(e){if(a.running)return;a.params=e,a.stopRequested=!1,a.running=!0;const n=performance.now();try{await ue();const t=await Re(e,n),o={reason:a.stopRequested?"stopped":"completed",processedCombinations:t.processedSegments,totalCombinations:t.totalSegments,resultsCount:t.resultsCount,elapsedMs:performance.now()-n};f({type:"COMPLETE",payload:o})}catch(t){const o=t instanceof Error?t.message:String(t),i=t instanceof Error?t.stack:void 0;console.error("[EggBootTimingWorker] Search error:",o),i&&console.error("[EggBootTimingWorker] Stack trace:",i),console.error("[EggBootTimingWorker] Params:",JSON.stringify(e,(s,r)=>typeof r=="bigint"?r.toString():r)),f({type:"ERROR",message:o,category:"WASM_INIT",fatal:!0})}finally{x()}}async function ue(){j()||await X()}function ge(e,n){const t=oe[e];if(!t)throw new Error(`Unknown ROM version: ${e}`);const o=t[n];if(!o)throw new Error(`Unknown ROM region: ${n}`);return o.nazo}function le(e,n){return n.type==="none"?e.EverstonePlanJs.None:e.EverstonePlanJs.fixed(n.nature)}function me(e,n){const t=new e.IndividualFilterJs;if(!n)return t;if(n.ivRanges&&Array.isArray(n.ivRanges))for(let o=0;o<6;o++){const i=n.ivRanges[o];i&&typeof i.min=="number"&&typeof i.max=="number"&&t.set_iv_range(o,i.min,i.max)}return n.nature!==void 0&&t.set_nature(n.nature),n.gender!==void 0&&t.set_gender(fe(n.gender)),n.ability!==void 0&&t.set_ability(n.ability),n.shiny!==void 0&&t.set_shiny(n.shiny),n.hiddenPowerType!==void 0&&t.set_hidden_power_type(n.hiddenPowerType),n.hiddenPowerPower!==void 0&&t.set_hidden_power_power(n.hiddenPowerPower),t}function fe(e){switch(e){case"male":return 0;case"female":return 1;case"genderless":return 2;default:return 0}}function he(e){switch(e){case 0:return"male";case 1:return"female";case 2:return"genderless";default:return"male"}}function Se(e,n,t){return e?{type:"known",hpType:n,power:t}:{type:"unknown"}}function Te(e,n){const t=Number(e.advance),o=[e.ivs[0]??0,e.ivs[1]??0,e.ivs[2]??0,e.ivs[3]??0,e.ivs[4]??0,e.ivs[5]??0];return{boot:{datetime:new Date(Date.UTC(e.year,e.month-1,e.date,e.hour,e.minute,e.second)),timer0:e.timer0,vcount:e.vcount,keyCode:e.keyCode,keyInputNames:ne(e.keyCode),macAddress:n},lcgSeedHex:e.lcgSeedHex,egg:{advance:t,isStable:e.isStable,egg:{lcgSeedHex:e.lcgSeedHex,mtSeedHex:e.mtSeedHex,ivs:o,nature:e.nature,gender:he(e.gender),ability:e.ability,shiny:e.shiny,pid:e.pid,hiddenPower:Se(e.hpKnown,e.hpType,e.hpPower)}},isStable:e.isStable}}async function Re(e,n){const o=$();if(!o.EggBootTimingSearchIterator)throw new Error("EggBootTimingSearchIterator not exposed in WASM");const i=ge(e.romVersion,e.romRegion),s=te(e.keyInputMask),{dateRange:r}=e,m=new Date(r.startYear,r.startMonth-1,r.startDay);let p;if(e.rangeSeconds!==void 0)p=e.rangeSeconds;else{const S=new Date(r.endYear,r.endMonth-1,r.endDay);p=Math.max(1,Math.floor((S.getTime()-m.getTime())/(1e3*60*60*24))+1)*24*60*60}const D=e.timer0Range.max-e.timer0Range.min+1,O=e.vcountRange.max-e.vcountRange.min+1,h=D*O*s.length,W=32,K=3600,F=500;let c=0,d=0,z=n;for(let S=e.timer0Range.min;S<=e.timer0Range.max&&c<e.maxResults;S++)for(let w=e.vcountRange.min;w<=e.vcountRange.max&&c<e.maxResults;w++)for(const V of s){if(a.stopRequested||c>=e.maxResults)return{resultsCount:c,processedSegments:d,totalSegments:h};const _=new o.ParentsIVsJs;_.male=e.parents.male,_.female=e.parents.female;const u=new o.GenerationConditionsJs;u.has_nidoran_flag=e.conditions.hasNidoranFlag,u.set_everstone(le(o,e.conditions.everstone)),u.uses_ditto=e.conditions.usesDitto;const N=e.conditions.femaleParentAbility===2;u.allow_hidden_ability=N,u.female_parent_has_hidden=N,u.reroll_count=e.conditions.masudaMethod?3:0,u.set_trainer_ids(new o.TrainerIds(e.conditions.tid,e.conditions.sid)),u.set_gender_ratio(new o.GenderRatio(e.conditions.genderRatio.threshold,e.conditions.genderRatio.genderless));const U=me(o,e.filterDisabled?null:e.filter),L=se(o,e,i),Y=ie(o,S,w,V),H=ae(o,e.timeRange),q=ce(o,m,p),I=new o.EggBootTimingSearchIterator(L,Y,H,q,u,_,U,e.considerNpcConsumption,re(e.gameMode),BigInt(e.userOffset),e.advanceCount);try{for(;!I.isFinished&&c<e.maxResults&&!a.stopRequested;){const P=I.next_batch(W,K);if(P.length>0){const T=[];for(let R=0;R<P.length&&c<e.maxResults;R++){const C=P[R];T.push(Te(C,e.macAddress)),c++}f({type:"RESULTS",payload:{results:T,batchIndex:d}})}const b=performance.now();if(b-z>=F){const T=b-n,R=d/h*100,C=d>0?T/d*(h-d):0;f({type:"PROGRESS",payload:{processedCombinations:d,totalCombinations:h,foundCount:c,progressPercent:R,elapsedMs:T,estimatedRemainingMs:C}}),z=b}}}finally{I.free?.(),u.free?.(),_.free?.()}d++}const G=performance.now()-n;return f({type:"PROGRESS",payload:{processedCombinations:d,totalCombinations:h,foundCount:c,progressPercent:100,elapsedMs:G,estimatedRemainingMs:0}}),{resultsCount:c,processedSegments:d,totalSegments:h}}function x(){a.running=!1,a.params=null,a.stopRequested=!1}k.onclose=()=>{x()};
