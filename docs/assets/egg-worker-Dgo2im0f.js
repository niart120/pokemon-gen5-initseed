var m=(e=>(e[e.BwNew=0]="BwNew",e[e.BwContinue=1]="BwContinue",e[e.Bw2New=2]="Bw2New",e[e.Bw2Continue=3]="Bw2Continue",e))(m||{});const R=1e5,h=65535;function v(e){const n=[];(e.count<1||e.count>R)&&n.push(`count must be 1-${R}`),(e.conditions.tid<0||e.conditions.tid>h)&&n.push(`tid must be 0-${h}`),(e.conditions.sid<0||e.conditions.sid>h)&&n.push(`sid must be 0-${h}`);const t=(s,o)=>{s.forEach((i,d)=>{(i<0||i>32)&&n.push(`${o}[${d}] must be 0-32`)})};return t(e.parents.male,"parents.male"),t(e.parents.female,"parents.female"),e.filter&&e.filter.ivRanges.forEach((s,o)=>{(s.min<0||s.min>32)&&n.push(`filter.ivRanges[${o}].min must be 0-32`),(s.max<0||s.max>32)&&n.push(`filter.ivRanges[${o}].max must be 0-32`),s.min>s.max&&n.push(`filter.ivRanges[${o}].min must be <= max`)}),n}let u=null,l=null;async function E(){return u||l||(l=(async()=>{try{const e=await import("./wasm_pkg-C5EHw6sq.js");let n;if(typeof process<"u"&&!!process.versions?.node){const s=await import("./__vite-browser-external-9wXp6ZBx.js"),i=(await import("./__vite-browser-external-9wXp6ZBx.js")).join(process.cwd(),"src/wasm/wasm_pkg_bg.wasm");n={module_or_path:s.readFileSync(i)}}else n={module_or_path:new URL("/pokemon-gen5-initseed/assets/wasm_pkg_bg-CfOfPGCt.wasm",import.meta.url)};return await e.default(n),u={BWGenerationConfig:e.BWGenerationConfig,PokemonGenerator:e.PokemonGenerator,SeedEnumerator:e.SeedEnumerator,EncounterType:e.EncounterType,GameVersion:e.GameVersion,GameMode:e.GameMode,EggSeedEnumeratorJs:e.EggSeedEnumeratorJs,ParentsIVsJs:e.ParentsIVsJs,GenerationConditionsJs:e.GenerationConditionsJs,EverstonePlanJs:e.EverstonePlanJs,IndividualFilterJs:e.IndividualFilterJs,TrainerIds:e.TrainerIds,GenderRatio:e.GenderRatio,StatRange:e.StatRange,EggBootTimingSearchResult:e.EggBootTimingSearchResult,EggBootTimingSearchIterator:e.EggBootTimingSearchIterator,DSConfigJs:e.DSConfigJs,SegmentParamsJs:e.SegmentParamsJs,TimeRangeParamsJs:e.TimeRangeParamsJs,SearchRangeParamsJs:e.SearchRangeParamsJs,MtSeedBootTimingSearchIterator:e.MtSeedBootTimingSearchIterator,MtSeedBootTimingSearchResult:e.MtSeedBootTimingSearchResult,MtSeedBootTimingSearchResults:e.MtSeedBootTimingSearchResults,IdAdjustmentSearchIterator:e.IdAdjustmentSearchIterator,IdAdjustmentSearchResult:e.IdAdjustmentSearchResult,IdAdjustmentSearchResults:e.IdAdjustmentSearchResults,calculate_game_offset:e.calculate_game_offset,sha1_hash_batch:e.sha1_hash_batch,mt_seed_search_segment:e.mt_seed_search_segment},u}catch(e){throw console.error("Failed to load WebAssembly module:",e),u=null,l=null,e}})(),l)}function T(){if(!u)throw new Error("WebAssembly module not initialized. Call initWasm() first.");return u}function P(){return u!==null}const a={params:null,running:!1,stopRequested:!1};function J(e){switch(e){case m.BwNew:return 0;case m.BwContinue:return 2;case m.Bw2New:return 5;case m.Bw2Continue:return 7;default:return 2}}const _=self,c=e=>_.postMessage(e);c({type:"READY",version:"1"});_.onmessage=e=>{const n=e.data;(async()=>{try{switch(n.type){case"START_GENERATION":await B(n.params);break;case"STOP":a.stopRequested=!0;break;default:break}}catch(t){const s=t instanceof Error?t.message:String(t);c({type:"ERROR",message:s,category:"RUNTIME",fatal:!1})}})()};async function B(e){if(a.running)return;const n=v(e);if(n.length){c({type:"ERROR",message:n.join(", "),category:"VALIDATION",fatal:!1});return}a.params=e,a.stopRequested=!1,a.running=!0;try{await A();const t=D(e);U(t.results),c({type:"COMPLETE",payload:t.completion})}catch(t){const s=t instanceof Error?t.message:String(t);c({type:"ERROR",message:s,category:"WASM_INIT",fatal:!0})}finally{b()}}async function A(){P()||await E()}function C(e,n){return n.type==="none"?e.EverstonePlanJs.None:e.EverstonePlanJs.fixed(n.nature)}function W(e,n){const t=new e.IndividualFilterJs;if(!n)return t;for(let s=0;s<6;s++){const o=n.ivRanges[s];t.set_iv_range(s,o.min,o.max)}return n.nature!==void 0&&t.set_nature(n.nature),n.gender!==void 0&&t.set_gender(x(n.gender)),n.ability!==void 0&&t.set_ability(n.ability),n.shinyFilterMode!==void 0&&t.set_shiny_filter_mode(O(n.shinyFilterMode)),n.hiddenPowerType!==void 0&&t.set_hidden_power_type(n.hiddenPowerType),n.hiddenPowerPower!==void 0&&t.set_hidden_power_power(n.hiddenPowerPower),t}function x(e){switch(e){case"male":return 0;case"female":return 1;case"genderless":return 2;default:return 0}}function O(e){switch(e){case"all":return 0;case"shiny":return 1;case"star":return 2;case"square":return 3;case"non-shiny":return 4;default:return 0}}function M(e){switch(e){case 0:return"male";case 1:return"female";case 2:return"genderless";default:return"male"}}function k(e){return!e||e.type==="unknown"||e==="Unknown"?{type:"unknown"}:{type:"known",hpType:e.hp_type??e.hpType??0,power:e.power??0}}function V(e){if(!e)return null;try{const n=Number(e.advance),t=e.egg,s=t.lcg_seed_hex??t.lcgSeedHex??"0x0",o=t.mt_seed_hex??t.mtSeedHex??"00000000",i={lcgSeedHex:s,mtSeedHex:o,ivs:[t.ivs[0],t.ivs[1],t.ivs[2],t.ivs[3],t.ivs[4],t.ivs[5]],nature:(typeof t.nature=="number",t.nature),gender:M(typeof t.gender=="number"?t.gender:0),ability:typeof t.ability=="number"?t.ability:0,shiny:typeof t.shiny=="number"?t.shiny:0,pid:t.pid,hiddenPower:k(t.hidden_power??t.hiddenPower)};return{advance:n,egg:i,isStable:e.is_stable??e.isStable??!1}}catch{return null}}function D(e){const t=T();if(!t.EggSeedEnumeratorJs)throw new Error("EggSeedEnumeratorJs not exposed in WASM");const s=[];let o=0,i=0,d="max-count";const N=performance.now(),f=new t.ParentsIVsJs;f.male=e.parents.male,f.female=e.parents.female;const r=new t.GenerationConditionsJs;r.has_nidoran_flag=e.conditions.hasNidoranFlag,r.set_everstone(C(t,e.conditions.everstone)),r.uses_ditto=e.conditions.usesDitto;const y=e.conditions.femaleParentAbility===2;r.allow_hidden_ability=y,r.female_parent_has_hidden=y,r.reroll_count=e.conditions.masudaMethod?3:0,r.set_trainer_ids(new t.TrainerIds(e.conditions.tid,e.conditions.sid)),r.set_gender_ratio(new t.GenderRatio(e.conditions.genderRatio.threshold,e.conditions.genderRatio.genderless));const w=W(t,e.filterDisabled?null:e.filter),p=new t.EggSeedEnumeratorJs(e.baseSeed,e.userOffset,e.count,r,f,w,e.considerNpcConsumption,J(e.gameMode));try{for(;;){if(a.stopRequested){d="stopped";break}const g=p.next_egg();if(!g){d="max-count";break}o++;const S=V(g);S&&(s.push(S),i++)}}catch(g){throw d="error",g}finally{p.free(),r.free?.(),f.free?.(),w&&w.free?.()}const I={reason:d,processedCount:o,filteredCount:i,elapsedMs:performance.now()-N};return{results:s,completion:I}}function U(e){c({type:"RESULTS",payload:{results:e}})}function b(){a.running=!1,a.params=null,a.stopRequested=!1}_.onclose=()=>{b()};
