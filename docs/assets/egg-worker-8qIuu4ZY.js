var f=(e=>(e[e.BwNew=0]="BwNew",e[e.BwContinue=1]="BwContinue",e[e.Bw2New=2]="Bw2New",e[e.Bw2Continue=3]="Bw2Continue",e))(f||{});const N=1e5,h=65535;function S(e){const t=[];(e.count<1||e.count>N)&&t.push(`count must be 1-${N}`),(e.conditions.tid<0||e.conditions.tid>h)&&t.push(`tid must be 0-${h}`),(e.conditions.sid<0||e.conditions.sid>h)&&t.push(`sid must be 0-${h}`);const n=(s,o)=>{s.forEach((u,c)=>{(u<0||u>32)&&t.push(`${o}[${c}] must be 0-32`)})};return n(e.parents.male,"parents.male"),n(e.parents.female,"parents.female"),e.filter&&e.filter.ivRanges.forEach((s,o)=>{(s.min<0||s.min>32)&&t.push(`filter.ivRanges[${o}].min must be 0-32`),(s.max<0||s.max>32)&&t.push(`filter.ivRanges[${o}].max must be 0-32`),s.min>s.max&&t.push(`filter.ivRanges[${o}].min must be <= max`)}),t}let a=null,l=null;async function I(){return a||l||(l=(async()=>{try{const e=await import("./wasm_pkg-D60-6A8E.js");let t;if(typeof process<"u"&&!!process.versions?.node){const s=await import("./__vite-browser-external-9wXp6ZBx.js"),u=(await import("./__vite-browser-external-9wXp6ZBx.js")).join(process.cwd(),"src/wasm/wasm_pkg_bg.wasm");t={module_or_path:s.readFileSync(u)}}else t={module_or_path:new URL("/pokemon-gen5-initseed/assets/wasm_pkg_bg-BRqvMkcK.wasm",import.meta.url)};return await e.default(t),a={IntegratedSeedSearcher:e.IntegratedSeedSearcher,BWGenerationConfig:e.BWGenerationConfig,PokemonGenerator:e.PokemonGenerator,SeedEnumerator:e.SeedEnumerator,EncounterType:e.EncounterType,GameVersion:e.GameVersion,GameMode:e.GameMode,EggSeedEnumeratorJs:e.EggSeedEnumeratorJs,ParentsIVsJs:e.ParentsIVsJs,GenerationConditionsJs:e.GenerationConditionsJs,EverstonePlanJs:e.EverstonePlanJs,IndividualFilterJs:e.IndividualFilterJs,TrainerIds:e.TrainerIds,GenderRatio:e.GenderRatio,StatRange:e.StatRange,EggBootTimingSearcher:e.EggBootTimingSearcher,EggBootTimingSearchResult:e.EggBootTimingSearchResult,calculate_game_offset:e.calculate_game_offset,sha1_hash_batch:e.sha1_hash_batch},a}catch(e){throw console.error("Failed to load WebAssembly module:",e),a=null,l=null,e}})(),l)}function T(){if(!a)throw new Error("WebAssembly module not initialized. Call initWasm() first.");return a}function P(){return a!==null}const r={params:null,running:!1,stopRequested:!1};function W(e){switch(e){case f.BwNew:return 0;case f.BwContinue:return 2;case f.Bw2New:return 5;case f.Bw2Continue:return 7;default:return 2}}const p=self,d=e=>p.postMessage(e);d({type:"READY",version:"1"});p.onmessage=e=>{const t=e.data;(async()=>{try{switch(t.type){case"START_GENERATION":await B(t.params);break;case"STOP":r.stopRequested=!0;break;default:break}}catch(n){const s=n instanceof Error?n.message:String(n);d({type:"ERROR",message:s,category:"RUNTIME",fatal:!1})}})()};async function B(e){if(r.running)return;const t=S(e);if(t.length){d({type:"ERROR",message:t.join(", "),category:"VALIDATION",fatal:!1});return}r.params=e,r.stopRequested=!1,r.running=!0;try{await x();const n=U(e);$(n.results),d({type:"COMPLETE",payload:n.completion})}catch(n){const s=n instanceof Error?n.message:String(n);d({type:"ERROR",message:s,category:"WASM_INIT",fatal:!0})}finally{v()}}async function x(){P()||await I()}function J(e,t){return t.type==="none"?e.EverstonePlanJs.None:e.EverstonePlanJs.fixed(t.nature)}function C(e,t){const n=new e.IndividualFilterJs;if(!t)return n;for(let s=0;s<6;s++){const o=t.ivRanges[s];n.set_iv_range(s,o.min,o.max)}return t.nature!==void 0&&n.set_nature(t.nature),t.gender!==void 0&&n.set_gender(O(t.gender)),t.ability!==void 0&&n.set_ability(t.ability),t.shiny!==void 0&&n.set_shiny(t.shiny),t.hiddenPowerType!==void 0&&n.set_hidden_power_type(t.hiddenPowerType),t.hiddenPowerPower!==void 0&&n.set_hidden_power_power(t.hiddenPowerPower),n}function O(e){switch(e){case"male":return 0;case"female":return 1;case"genderless":return 2;default:return 0}}function k(e){switch(e){case 0:return"male";case 1:return"female";case 2:return"genderless";default:return"male"}}function A(e){return!e||e.type==="unknown"||e==="Unknown"?{type:"unknown"}:{type:"known",hpType:e.hp_type??e.hpType??0,power:e.power??0}}function V(e){if(!e)return null;try{const t=Number(e.advance),n=e.egg,o={lcgSeedHex:n.lcg_seed_hex??n.lcgSeedHex??"0x0",ivs:[n.ivs[0],n.ivs[1],n.ivs[2],n.ivs[3],n.ivs[4],n.ivs[5]],nature:(typeof n.nature=="number",n.nature),gender:k(typeof n.gender=="number"?n.gender:0),ability:typeof n.ability=="number"?n.ability:0,shiny:typeof n.shiny=="number"?n.shiny:0,pid:n.pid,hiddenPower:A(n.hidden_power??n.hiddenPower)};return{advance:t,egg:o,isStable:e.is_stable??e.isStable??!1}}catch{return null}}function U(e){const n=T();if(!n.EggSeedEnumeratorJs)throw new Error("EggSeedEnumeratorJs not exposed in WASM");const s=[];let o=0,u=0,c="max-count";const E=performance.now(),m=new n.ParentsIVsJs;m.male=e.parents.male,m.female=e.parents.female;const i=new n.GenerationConditionsJs;i.has_nidoran_flag=e.conditions.hasNidoranFlag,i.set_everstone(J(n,e.conditions.everstone)),i.uses_ditto=e.conditions.usesDitto;const y=e.conditions.femaleParentAbility===2;i.allow_hidden_ability=y,i.female_parent_has_hidden=y,i.reroll_count=e.conditions.masudaMethod?3:0,i.set_trainer_ids(new n.TrainerIds(e.conditions.tid,e.conditions.sid)),i.set_gender_ratio(new n.GenderRatio(e.conditions.genderRatio.threshold,e.conditions.genderRatio.genderless));const w=C(n,e.filter),_=new n.EggSeedEnumeratorJs(e.baseSeed,e.userOffset,e.count,i,m,w,e.considerNpcConsumption,W(e.gameMode));try{for(;;){if(r.stopRequested){c="stopped";break}const g=_.next_egg();if(!g){c="max-count";break}o++;const b=V(g);b&&(s.push(b),u++)}}catch(g){throw c="error",g}finally{_.free(),i.free?.(),m.free?.(),w&&w.free?.()}const R={reason:c,processedCount:o,filteredCount:u,elapsedMs:performance.now()-E};return{results:s,completion:R}}function $(e){d({type:"RESULTS",payload:{results:e}})}function v(){r.running=!1,r.params=null,r.stopRequested=!1}p.onclose=()=>{v()};
