class q{calculateHash(t){if(t.length!==16)throw new Error("Message must be exactly 16 32-bit words (64 bytes)");const n=1732584193,s=4023233417,r=2562383102,a=271733878,c=3285377520,o=new Array(80);for(let l=0;l<16;l++)o[l]=t[l];for(let l=16;l<80;l++)o[l]=this.leftRotate(o[l-3]^o[l-8]^o[l-14]^o[l-16],1);let m=n,u=s,g=r,d=a,h=c;for(let l=0;l<80;l++){let w;l<20?w=this.leftRotate(m,5)+(u&g|~u&d)+h+o[l]+1518500249&4294967295:l<40?w=this.leftRotate(m,5)+(u^g^d)+h+o[l]+1859775393&4294967295:l<60?w=this.leftRotate(m,5)+(u&g|u&d|g&d)+h+o[l]+2400959708&4294967295:w=this.leftRotate(m,5)+(u^g^d)+h+o[l]+3395469782&4294967295,h=d,d=g,g=this.leftRotate(u,30),u=m,m=w}const M=this.add32(n,m),p=this.add32(s,u),S=this.add32(r,g),T=this.add32(a,d),R=this.add32(c,h);return{h0:M,h1:p,h2:S,h3:T,h4:R}}leftRotate(t,n){return(t<<n|t>>>32-n)>>>0}add32(t,n){return(t+n&4294967295)>>>0}static hashToHex(t,n,s,r,a){return t.toString(16).padStart(8,"0")+n.toString(16).padStart(8,"0")+s.toString(16).padStart(8,"0")+r.toString(16).padStart(8,"0")+a.toString(16).padStart(8,"0")}}let P=null,F=null;async function le(){return P||F||(F=(async()=>{try{const e=await import("./wasm_pkg-D60-6A8E.js");let t;if(typeof process<"u"&&!!process.versions?.node){const s=await import("./__vite-browser-external-9wXp6ZBx.js"),a=(await import("./__vite-browser-external-9wXp6ZBx.js")).join(process.cwd(),"src/wasm/wasm_pkg_bg.wasm");t={module_or_path:s.readFileSync(a)}}else t={module_or_path:new URL("/pokemon-gen5-initseed/assets/wasm_pkg_bg-BRqvMkcK.wasm",import.meta.url)};return await e.default(t),P={IntegratedSeedSearcher:e.IntegratedSeedSearcher,BWGenerationConfig:e.BWGenerationConfig,PokemonGenerator:e.PokemonGenerator,SeedEnumerator:e.SeedEnumerator,EncounterType:e.EncounterType,GameVersion:e.GameVersion,GameMode:e.GameMode,EggSeedEnumeratorJs:e.EggSeedEnumeratorJs,ParentsIVsJs:e.ParentsIVsJs,GenerationConditionsJs:e.GenerationConditionsJs,EverstonePlanJs:e.EverstonePlanJs,IndividualFilterJs:e.IndividualFilterJs,TrainerIds:e.TrainerIds,GenderRatio:e.GenderRatio,StatRange:e.StatRange,EggBootTimingSearcher:e.EggBootTimingSearcher,EggBootTimingSearchResult:e.EggBootTimingSearchResult,calculate_game_offset:e.calculate_game_offset,sha1_hash_batch:e.sha1_hash_batch},P}catch(e){throw console.error("Failed to load WebAssembly module:",e),P=null,F=null,e}})(),F)}function de(){if(!P)throw new Error("WebAssembly module not initialized. Call initWasm() first.");return P}function X(){return P!==null}const ge={B:{JPN:{nazo:[35741456,35741708,35741708,35741784,35741784],vcountTimerRanges:[[96,3193,3194]]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[[96,3204,3205]]},USA:{nazo:[35741872,35742124,35742124,35742200,35742200],vcountTimerRanges:[[96,3195,3196]]},GER:{nazo:[35741680,35741932,35741932,35742008,35742008],vcountTimerRanges:[[95,3191,3192]]},FRA:{nazo:[35741744,35741996,35741996,35742072,35742072],vcountTimerRanges:[[95,3187,3188]]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[[96,3206,3207]]},ITA:{nazo:[35741616,35741868,35741868,35741944,35741944],vcountTimerRanges:[[95,3178,3179]]}},W:{JPN:{nazo:[35741488,35741740,35741740,35741816,35741816],vcountTimerRanges:[[95,3175,3177]]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[[96,3195,3196]]},USA:{nazo:[35741904,35742156,35742156,35742232,35742232],vcountTimerRanges:[[96,3198,3200]]},GER:{nazo:[35741712,35741964,35741964,35742040,35742040],vcountTimerRanges:[[96,3194,3195]]},FRA:{nazo:[35741776,35742028,35742028,35742104,35742104],vcountTimerRanges:[[95,3182,3183]]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[[95,3184,3185]]},ITA:{nazo:[35741648,35741900,35741900,35741976,35741976],vcountTimerRanges:[[96,3195,3196]]}},B2:{JPN:{nazo:[34187484,33790665,35649968,35650052,35650052],vcountTimerRanges:[[130,4354,4360]]},KOR:{nazo:[34190860,33793237,35653456,35653540,35653540],vcountTimerRanges:[[130,4335,4340]]},USA:{nazo:[34189032,33791465,35651600,35651684,35651684],vcountTimerRanges:[[130,4354,4360]]},GER:{nazo:[34188840,33791337,35651408,35651492,35651492],vcountTimerRanges:[[129,4325,4328],[130,4329,4332]]},FRA:{nazo:[34189064,33791481,35651632,35651716,35651716],vcountTimerRanges:[[130,4340,4344]]},SPA:{nazo:[34188968,33791417,35651536,35651620,35651620],vcountTimerRanges:[[130,4353,4358]]},ITA:{nazo:[34188776,33791337,35651344,35651428,35651428],vcountTimerRanges:[[130,4359,4361],[131,4361,4365]]}},W2:{JPN:{nazo:[34187516,33790709,3565e4,35650084,35650084],vcountTimerRanges:[[130,4341,4347]]},KOR:{nazo:[34190892,33793281,35653488,35653572,35653572],vcountTimerRanges:[[129,4324,4329]]},USA:{nazo:[34189096,33791509,35651664,35651748,35651748],vcountTimerRanges:[[130,4338,4342]]},GER:{nazo:[34188872,33791381,35651440,35651524,35651524],vcountTimerRanges:[[130,4325,4333]]},FRA:{nazo:[34189096,33791525,35651664,35651748,35651748],vcountTimerRanges:[[130,4332,4336]]},SPA:{nazo:[34189e3,33791461,35651568,35651652,35651652],vcountTimerRanges:[[130,4335,4340]]},ITA:{nazo:[34188840,33791381,35651408,35651492,35651492],vcountTimerRanges:[[130,4351,4356]]}}},Z=[["A",0],["B",1],["Select",2],["Start",3],["[→]",4],["[←]",5],["[↑]",6],["[↓]",7],["R",8],["L",9],["X",10],["Y",11]],v=Z.reduce((e,[t,n])=>(e[t]=n,e),{}),Q=Z.length,he=(1<<Q)-1,fe=12287,Se=[1<<v["[↑]"]|1<<v["[↓]"],1<<v["[←]"]|1<<v["[→]"],1<<v.Select|1<<v.Start|1<<v.L|1<<v.R];function $(e,t){return Number.isFinite(e)?e&he:0}function we(e){const t=$(e);return fe^t}function Re(e){const t=$(e);for(const n of Se)if((t&n)===n)return!0;return!1}function ee(e){return we(e)}function te(e){const t=$(e),n=[];for(let a=0;a<Q;a+=1)(t&1<<a)!==0&&n.push(a);const s=1<<n.length;let r=0;for(let a=0;a<s;a+=1){let c=0;for(let o=0;o<n.length;o+=1)(a&1<<o)!==0&&(c|=1<<n[o]);Re(c)||(r+=1)}return r>0?r:1}const Me={DS:8,DS_LITE:6,"3DS":9};class pe{sha1;useWasm=!1;constructor(){this.sha1=new q}async initializeWasm(){try{return await le(),this.useWasm=!0,!0}catch(t){return console.warn("WebAssembly initialization failed, falling back to TypeScript:",t),this.useWasm=!1,!1}}isUsingWasm(){return this.useWasm&&X()}getWasmModule(){return de()}setUseWasm(t){if(t&&!X()){console.warn("Cannot enable WebAssembly: module not initialized");return}this.useWasm=t}getROMParameters(t,n){const s=ge[t];if(!s)return console.error(`ROM version not found: ${t}`),null;const r=s[n];return r?{nazo:[...r.nazo],vcountTimerRanges:r.vcountTimerRanges.map(a=>[...a])}:(console.error(`ROM region not found: ${n} for version ${t}`),null)}toLittleEndian32(t){return((t&255)<<24|(t>>>8&255)<<16|(t>>>16&255)<<8|t>>>24&255)>>>0}toLittleEndian16(t){return(t&255)<<8|t>>>8&255}getDayOfWeek(t,n,s){return new Date(t,n-1,s).getDay()}generateMessage(t,n,s,r,a){const c=this.getROMParameters(t.romVersion,t.romRegion);if(!c)throw new Error(`No parameters found for ${t.romVersion} ${t.romRegion}`);const o=new Array(16).fill(0);for(let D=0;D<5;D++)o[D]=this.toLittleEndian32(c.nazo[D]);o[5]=this.toLittleEndian32(s<<16|n);const m=t.macAddress[4]<<8|t.macAddress[5];o[6]=m;const u=t.macAddress[0]<<0|t.macAddress[1]<<8|t.macAddress[2]<<16|t.macAddress[3]<<24,g=100663296,d=Me[t.hardware],h=u^g^d;o[7]=this.toLittleEndian32(h);const M=r.getFullYear()%100,p=r.getMonth()+1,S=r.getDate(),T=this.getDayOfWeek(r.getFullYear(),p,S),R=Math.floor(M/10)*16+M%10,l=Math.floor(p/10)*16+p%10,w=Math.floor(S/10)*16+S%10,y=Math.floor(T/10)*16+T%10;o[8]=R<<24|l<<16|w<<8|y;const I=r.getHours(),A=r.getMinutes(),_=r.getSeconds(),W=(t.hardware==="DS"||t.hardware==="DS_LITE")&&I>=12?1:0,O=Math.floor(I/10)*16+I%10,C=Math.floor(A/10)*16+A%10,z=Math.floor(_/10)*16+_%10;o[9]=W<<30|O<<24|C<<16|z<<8|0,o[10]=0,o[11]=0;const x=a??ee(t.keyInput);return o[12]=this.toLittleEndian32(x),o[13]=2147483648,o[14]=0,o[15]=416,o}calculateSeed(t){const n=this.sha1.calculateHash(t),s=BigInt(this.toLittleEndian32(n.h0)),a=BigInt(this.toLittleEndian32(n.h1))<<32n|s,m=a*0x5D588B656C078965n+0x269EC3n;return{seed:Number(m>>32n&0xFFFFFFFFn),hash:q.hashToHex(n.h0,n.h1,n.h2,n.h3,n.h4),lcgSeed:a}}parseTargetSeeds(t){const n=t.split(`
`).map(c=>c.trim()).filter(c=>c.length>0),s=[],r=[],a=new Set;return n.forEach((c,o)=>{try{let m=c.toLowerCase();if(m.startsWith("0x")&&(m=m.substring(2)),!/^[0-9a-f]{1,8}$/.test(m)){r.push({line:o+1,value:c,error:"Invalid hexadecimal format. Expected 1-8 hex digits."});return}const u=parseInt(m,16);if(a.has(u))return;a.add(u),s.push(u)}catch(m){const u=m instanceof Error?m.message:String(m);r.push({line:o+1,value:c,error:u||"Failed to parse as hexadecimal number."})}}),{validSeeds:s,errors:r}}getVCountForTimer0(t,n){for(const[s,r,a]of t.vcountTimerRanges)if(n>=r&&n<=a)return s;return t.vcountTimerRanges.length>0?t.vcountTimerRanges[0][0]:96}}function Te(e){const t=new Uint8Array(6);for(let n=0;n<6;n++){const s=e[n]??0;let r;if(typeof s=="number")r=s;else{const a=s.trim().toLowerCase();r=a.startsWith("0x")||Number.isNaN(Number(a))?parseInt(a,16):Number(a)}Number.isFinite(r)||(r=0),r=Math.min(255,Math.max(0,Math.trunc(r))),t[n]=r}return t}const b=1e3,V=60,ne=60,re=24,H=V*ne,B=H*re,U=B*b;function se(e){const t=e.timeRange;if(!t)throw new Error("timeRange is required for seed search");const n=L("hour",t.hour,0,re-1),s=L("minute",t.minute,0,ne-1),r=L("second",t.second,0,V-1),a=new Date(e.dateRange.startYear,e.dateRange.startMonth-1,e.dateRange.startDay,0,0,0),c=new Date(e.dateRange.endYear,e.dateRange.endMonth-1,e.dateRange.endDay,0,0,0),o=a.getTime(),m=c.getTime();if(o>m)throw new Error("開始日が終了日より後に設定されています");const u=Math.floor((m-o)/U)+1;if(u<=0)throw new Error("探索日数が検出できませんでした");const g=n.count*s.count*r.count;if(g<=0)throw new Error("時刻レンジの組み合わせ数が0です");const d=new Date(e.dateRange.startYear,e.dateRange.startMonth-1,e.dateRange.startDay,n.start,s.start,r.start,0);return{plan:{dayCount:u,combosPerDay:g,hourRangeStart:n.start,hourRangeCount:n.count,minuteRangeStart:s.start,minuteRangeCount:s.count,secondRangeStart:r.start,secondRangeCount:r.count,startDayTimestampMs:o},firstCombinationDate:d}}function ae(e,t,n){if(n<=t)return 0;const s=G(e);let r=t,a=0;for(;r<n;){const{dayStartMs:c,dayEndMs:o}=oe(e,r),m=Math.min(o,n),u=Math.max(0,Math.floor((r-c)/b)),g=Math.max(u,Math.min(B,Math.ceil((m-c)/b))),d=Math.max(u,s.startSecond),h=Math.min(g,s.endSecondExclusive);d<h&&(a+=h-d),r=m}return a}function Ee(e,t,n,s){if(n<=t)return{endTimestampMs:n,countedSeconds:0};const r=Math.max(0,s),a=G(e);let c=t,o=0,m,u;for(;c<n;){const{dayStartMs:g,dayEndMs:d}=oe(e,c),h=Math.min(d,n),M=Math.max(0,Math.floor((c-g)/b)),p=Math.max(M,Math.min(B,Math.ceil((h-g)/b))),S=Math.max(M,a.startSecond),T=Math.min(p,a.endSecondExclusive);if(S<T){const R=g+S*b,l=T-S,w=r>0?Math.min(l,r-o):l;if(w>0){o+=w,m===void 0&&(m=R),u=R+(w-1)*b;const y=R+w*b;if(r>0&&o>=r)return{endTimestampMs:y,countedSeconds:o,firstAllowedTimestampMs:m,lastAllowedTimestampMs:u};c=Math.max(y,h);continue}}c=h}return{endTimestampMs:c,countedSeconds:o,firstAllowedTimestampMs:m,lastAllowedTimestampMs:u}}function ke(e,t){const n=e.getHours()*H+e.getMinutes()*V+e.getSeconds(),s=G(t);return n>=s.startSecond&&n<s.endSecondExclusive}function L(e,t,n,s){if(!t)throw new Error(`${e} range is required for WebGPU search`);const r=Math.trunc(t.start),a=Math.trunc(t.end);if(Number.isNaN(r)||Number.isNaN(a))throw new Error(`${e} range must be numeric`);if(r<n||a>s)throw new Error(`${e} range must be within ${n} to ${s}`);if(r>a)throw new Error(`${e} range start must be <= end`);return{start:r,end:a,count:a-r+1}}function G(e){const t=e.hourRangeStart*H+e.minuteRangeStart*V+e.secondRangeStart,n=Math.min(t+e.combosPerDay,B);return{startSecond:t,endSecondExclusive:n}}function oe(e,t){const n=t-e.startDayTimestampMs,s=Math.floor(n/U),r=e.startDayTimestampMs+s*U;return{dayStartMs:r,dayEndMs:r+U}}const j=1e3;function*ye(e){const{plan:t,chunkStartMs:n,chunkEndExclusiveMs:s,desiredAllowedSeconds:r,maxSecondsPerChunk:a}=e;if(s<=n)return;const c=Math.max(1,Math.floor(r)),o=Ie(a),m=c;let u=n;for(;u<s;){const g=Math.min(s,u+o*j),{endTimestampMs:d,countedSeconds:h,firstAllowedTimestampMs:M,lastAllowedTimestampMs:p}=Ee(t,u,g,m);if(h<=0||M===void 0){if(d<=u)break;u=d;continue}const S=Math.max(0,d-M),T=Math.max(h,Math.ceil(S/j));if(yield{startTimestampMs:M,durationSeconds:T,countedSeconds:h,lastAllowedTimestampMs:p},d<=u)break;u=d}}function Ie(e){return Number.isFinite(e)?Math.max(1,Math.floor(e)):Number.MAX_SAFE_INTEGER}const i={isRunning:!1,isPaused:!1,shouldStop:!1,workerId:-1,chunk:null,startTime:0},E={cumulativeRunTime:0,segmentStartTime:0,isPaused:!1};let k;const Ae=1e6;function Ce(e){return Array.isArray(e)?e.filter(t=>typeof t=="number"&&Number.isFinite(t)):[]}function De(){E.cumulativeRunTime=0,E.segmentStartTime=Date.now(),E.isPaused=!1}function ve(){E.isPaused||(E.cumulativeRunTime+=Date.now()-E.segmentStartTime,E.isPaused=!0)}function Pe(){E.isPaused&&(E.segmentStartTime=Date.now(),E.isPaused=!1)}function be(){return E.isPaused?E.cumulativeRunTime:E.cumulativeRunTime+(Date.now()-E.segmentStartTime)}async function _e(){if(!k){k=new pe;try{await k.initializeWasm()}catch(e){console.warn(`Worker ${i.workerId}: WebAssembly failed, using TypeScript fallback:`,e)}}}async function Oe(e,t){if(!i.chunk)throw new Error("No chunk assigned to worker");i.startTime=Date.now();let n=0;try{if(k.isUsingWasm()){const s=await xe(e,t);n=s.length;for(const r of s)postMessage({type:"RESULT",workerId:i.workerId,result:{...r,datetime:r.datetime.toISOString()}})}else n=await Ne(e,t);postMessage({type:"COMPLETE",workerId:i.workerId,message:`Worker ${i.workerId} completed with ${n} matches`})}catch(s){console.error(`❌ Worker ${i.workerId}: Processing error:`,s),s instanceof Error&&s.stack&&console.error(`Worker ${i.workerId} stack trace:`,s.stack),postMessage({type:"ERROR",workerId:i.workerId,error:s instanceof Error?s.message:"Unknown error"})}}async function xe(e,t){const n=k.getWasmModule(),s=k.getROMParameters(e.romVersion,e.romRegion);if(!s)throw new Error(`No ROM parameters found for ${e.romVersion} ${e.romRegion}`);const a={DS:8,DS_LITE:6,"3DS":9}[e.hardware]||8,c=e.timeRange,o=c?.hour??{start:0,end:23},m=c?.minute??{start:0,end:59},u=c?.second??{start:0,end:59},g=new n.IntegratedSeedSearcher(Te(e.macAddress),new Uint32Array(s.nazo),e.hardware,e.keyInput,a,o.start,o.end,m.start,m.end,u.start,u.end),d=t.length>0?new Uint32Array(t):new Uint32Array(0),h=te(e.keyInput),M=e.timer0VCountConfig.timer0Range.max-e.timer0VCountConfig.timer0Range.min+1,p=e.timer0VCountConfig.vcountRange.max-e.timer0VCountConfig.vcountRange.min+1,S=M*p*Math.max(h,1),{plan:T}=se(e),R=i.chunk,l=R.startDateTime.getTime(),w=R.endDateTime.getTime()+1e3,y=ae(T,l,w);try{if(y===0)return N(0,0,0,R.startDateTime.toISOString()),[];const I=y*S,A=Math.floor(Ae/Math.max(S,1)),_=Math.max(1,A),W=7200*60,O=[];let C=0,z=R.startDateTime.toISOString();N(0,I,0,z);for(const x of ye({plan:T,chunkStartMs:l,chunkEndExclusiveMs:w,desiredAllowedSeconds:_,maxSecondsPerChunk:W})){if(i.shouldStop)break;if(i.isPaused){for(postMessage({type:"PAUSED",workerId:i.workerId});i.isPaused&&!i.shouldStop;)await new Promise(f=>setTimeout(f,100));i.shouldStop||postMessage({type:"RESUMED",workerId:i.workerId})}if(i.shouldStop)break;const D=new Date(x.startTimestampMs),K=x.durationSeconds;if(K<=0)continue;if(await new Promise(f=>setTimeout(f,0)),i.isPaused){for(;i.isPaused&&!i.shouldStop;)await new Promise(f=>setTimeout(f,100));if(i.shouldStop)break}const ie=g.search_seeds_integrated_simd(D.getFullYear(),D.getMonth()+1,D.getDate(),D.getHours(),D.getMinutes(),D.getSeconds(),K,e.timer0VCountConfig.timer0Range.min,e.timer0VCountConfig.timer0Range.max,e.timer0VCountConfig.vcountRange.min,e.timer0VCountConfig.vcountRange.max,d);await new Promise(f=>setTimeout(f,0));const ce=ie;for(const f of ce){const Y=new Date(f.year,f.month-1,f.date,f.hour,f.minute,f.second),J=k.generateMessage(e,f.timer0,f.vcount,Y,f.keyCode),{hash:ue,lcgSeed:me}=k.calculateSeed(J);O.push({seed:f.seed,datetime:Y,timer0:f.timer0,vcount:f.vcount,keyCode:f.keyCode??null,conditions:e,message:J,sha1Hash:ue,lcgSeed:me,isMatch:!0})}C+=x.countedSeconds*S,x.lastAllowedTimestampMs!==void 0&&(z=new Date(x.lastAllowedTimestampMs).toISOString()),N(C,I,O.length,z)}return O}finally{g.free()}}async function Ne(e,t){const n=i.chunk,s=new Set(t);let r=0,a=0,c=0;const o=ee(e.keyInput),m=te(e.keyInput);let u=n.startDateTime.toISOString();const g=k.getROMParameters(e.romVersion,e.romRegion);if(!g)throw new Error(`No ROM parameters found for ${e.romVersion} ${e.romRegion}`);const{plan:d}=se(e),h=n.startDateTime.getTime(),p=n.endDateTime.getTime()+1e3,S=ae(d,h,p),T=e.timer0VCountConfig.timer0Range.max-e.timer0VCountConfig.timer0Range.min+1;if(S===0)return N(0,0,0,n.startDateTime.toISOString()),0;const R=S*T*Math.max(m,1);N(0,R,0,u);for(let l=e.timer0VCountConfig.timer0Range.min;l<=e.timer0VCountConfig.timer0Range.max&&!i.shouldStop;l++){const w=k.getVCountForTimer0(g,l);for(let y=h;y<p&&!i.shouldStop;y+=1e3){for(;i.isPaused&&!i.shouldStop;)await new Promise(A=>setTimeout(A,100));if(i.shouldStop)break;const I=new Date(y);if(ke(I,d)){u=I.toISOString();try{const A=k.generateMessage(e,l,w,I,o),{seed:_,hash:W,lcgSeed:O}=k.calculateSeed(A);if(s.has(_)){const C={seed:_,datetime:I,timer0:l,vcount:w,keyCode:o,conditions:e,message:A,sha1Hash:W,lcgSeed:O,isMatch:!0};postMessage({type:"RESULT",workerId:i.workerId,result:{...C,datetime:C.datetime.toISOString()}}),r++}if(a+=m,c+=m,c>=1e3){if(N(a,R,r,u),c=0,i.isPaused)for(;i.isPaused&&!i.shouldStop;)await new Promise(C=>setTimeout(C,100));await new Promise(C=>setTimeout(C,0))}}catch(A){console.error(`Worker ${i.workerId}: Error calculating seed:`,A)}}}}return N(a,R,r,u),r}function N(e,t,n,s){const r=be(),a=e/t,c=a>0?Math.round(r/a*(1-a)):0;postMessage({type:"PROGRESS",workerId:i.workerId,progress:{currentStep:e,totalSteps:t,elapsedTime:r,estimatedTimeRemaining:c,matchesFound:n,currentDateTime:s??i.chunk?.startDateTime.toISOString()}})}self.onmessage=async e=>{const{type:t,conditions:n,targetSeeds:s,workerId:r,chunk:a}=e.data;switch(r!==void 0&&(i.workerId=r),t){case"START_SEARCH":{if(!n||!s||!a){postMessage({type:"ERROR",workerId:i.workerId,error:"Missing required parameters for search"});return}const c=Ce(s);if(c.length===0){const o="No valid target seeds were provided to the parallel worker.";console.error(`❌ Worker ${i.workerId}: ${o}`,{targetSeeds:s}),postMessage({type:"ERROR",workerId:i.workerId,error:o});return}i.chunk=a,i.isRunning=!0,i.shouldStop=!1,i.isPaused=!1,De();try{await _e(),await Oe(n,c)}catch(o){postMessage({type:"ERROR",workerId:i.workerId,error:o instanceof Error?o.message:"Unknown error"})}finally{i.isRunning=!1}break}case"PAUSE_SEARCH":i.isPaused=!0,ve(),postMessage({type:"PAUSED",workerId:i.workerId});break;case"RESUME_SEARCH":i.isPaused=!1,Pe(),postMessage({type:"RESUMED",workerId:i.workerId});break;case"STOP_SEARCH":i.shouldStop=!0,i.isRunning=!1,postMessage({type:"STOPPED",workerId:i.workerId});break;case"PING":postMessage({type:"INITIALIZED",workerId:i.workerId,message:`Pong from worker ${i.workerId}`});break}};postMessage({type:"READY",workerId:i.workerId,message:`Parallel worker ${i.workerId} initialized`});
