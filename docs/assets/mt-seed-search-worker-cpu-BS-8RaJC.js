function C(e){return[e>>25&31,e>>20&31,e>>15&31,e>>10&31,e>>5&31,e&31]}let o=null,u=null;async function G(){return o||u||(u=(async()=>{try{const e=await import("./wasm_pkg-R7J2WoRF.js");let t;if(typeof process<"u"&&!!process.versions?.node){const n=await import("./__vite-browser-external-9wXp6ZBx.js"),h=(await import("./__vite-browser-external-9wXp6ZBx.js")).join(process.cwd(),"src/wasm/wasm_pkg_bg.wasm");t={module_or_path:n.readFileSync(h)}}else t={module_or_path:new URL("/pokemon-gen5-initseed/assets/wasm_pkg_bg-V46_l7mn.wasm",import.meta.url)};return await e.default(t),o={BWGenerationConfig:e.BWGenerationConfig,PokemonGenerator:e.PokemonGenerator,SeedEnumerator:e.SeedEnumerator,EncounterType:e.EncounterType,GameVersion:e.GameVersion,GameMode:e.GameMode,EggSeedEnumeratorJs:e.EggSeedEnumeratorJs,ParentsIVsJs:e.ParentsIVsJs,GenerationConditionsJs:e.GenerationConditionsJs,EverstonePlanJs:e.EverstonePlanJs,IndividualFilterJs:e.IndividualFilterJs,TrainerIds:e.TrainerIds,GenderRatio:e.GenderRatio,StatRange:e.StatRange,EggBootTimingSearchResult:e.EggBootTimingSearchResult,EggBootTimingSearchIterator:e.EggBootTimingSearchIterator,DSConfigJs:e.DSConfigJs,SegmentParamsJs:e.SegmentParamsJs,TimeRangeParamsJs:e.TimeRangeParamsJs,SearchRangeParamsJs:e.SearchRangeParamsJs,MtSeedBootTimingSearchIterator:e.MtSeedBootTimingSearchIterator,MtSeedBootTimingSearchResult:e.MtSeedBootTimingSearchResult,MtSeedBootTimingSearchResults:e.MtSeedBootTimingSearchResults,IdAdjustmentSearchIterator:e.IdAdjustmentSearchIterator,IdAdjustmentSearchResult:e.IdAdjustmentSearchResult,IdAdjustmentSearchResults:e.IdAdjustmentSearchResults,calculate_game_offset:e.calculate_game_offset,sha1_hash_batch:e.sha1_hash_batch,mt_seed_search_segment:e.mt_seed_search_segment},o}catch(e){throw console.error("Failed to load WebAssembly module:",e),o=null,u=null,e}})(),u)}function k(){if(!o)throw new Error("WebAssembly module not initialized. Call initWasm() first.");return o}function B(){return o!==null}const s={job:null,running:!1,stopRequested:!1,isPaused:!1,pauseResolve:null},w=self,r=e=>w.postMessage(e);r({type:"READY",version:"1"});w.onmessage=e=>{const t=e.data;(async()=>{try{switch(t.type){case"START":await O(t.job);break;case"PAUSE":j();break;case"RESUME":W();break;case"STOP":s.stopRequested=!0,s.isPaused&&s.pauseResolve&&(s.pauseResolve(),s.pauseResolve=null,s.isPaused=!1);break;default:break}}catch(a){const n=a instanceof Error?a.message:String(a);r({type:"ERROR",message:n,category:"RUNTIME"})}})()};function j(){!s.running||s.isPaused||(s.isPaused=!0)}function W(){!s.running||!s.isPaused||(s.isPaused=!1,s.pauseResolve&&(s.pauseResolve(),s.pauseResolve=null))}async function U(){await new Promise(e=>setTimeout(e,0)),s.isPaused&&await new Promise(e=>{s.pauseResolve=e})}async function O(e){if(s.running)return;s.job=e,s.stopRequested=!1,s.running=!0;const t=performance.now();try{await q();const a=await V(e,t),n={reason:s.stopRequested?"stopped":"finished",totalProcessed:a.processedCount,totalMatches:a.matchesFound,elapsedMs:performance.now()-t};r({type:"COMPLETE",payload:n})}catch(a){const n=a instanceof Error?a.message:String(a);r({type:"ERROR",message:n,category:"RUNTIME"})}finally{b()}}async function q(){B()||await G()}const F=1048576,N=500;async function V(e,t){const n=k();if(!n.mt_seed_search_segment)throw new Error("mt_seed_search_segment not exposed in WASM");const{searchRange:y,ivCodes:h,mtAdvances:P,jobId:S}=e,{start:E,end:c}=y,v=new Uint32Array(h),_=c-E+1;let l=0,d=0,T=t,i=E;for(;i<=c&&(await U(),!s.stopRequested);){const m=Math.min(i+F-1,c),g=n.mt_seed_search_segment(i,m,P,v);if(g.length>0){const p=[];for(let f=0;f<g.length;f+=2){const A=g[f],I=g[f+1],J=C(I);p.push({mtSeed:A,ivCode:I,ivSet:J}),d++}r({type:"RESULTS",payload:{jobId:S,matches:p}})}l+=m-i+1;const R=performance.now();if(R-T>=N){const p={jobId:S,processedCount:l,totalCount:_,elapsedMs:R-t,matchesFound:d};r({type:"PROGRESS",payload:p}),T=R}if(m>=c)break;i=m+1}const M={jobId:S,processedCount:l,totalCount:_,elapsedMs:performance.now()-t,matchesFound:d};return r({type:"PROGRESS",payload:M}),{processedCount:l,matchesFound:d}}function b(){s.running=!1,s.job=null,s.stopRequested=!1,s.isPaused=!1,s.pauseResolve=null}w.onclose=()=>{b()};
