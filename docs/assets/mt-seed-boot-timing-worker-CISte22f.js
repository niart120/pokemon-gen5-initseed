const w=[["A",0],["B",1],["Select",2],["Start",3],["[→]",4],["[←]",5],["[↑]",6],["[↓]",7],["R",8],["L",9],["X",10],["Y",11]],m=w.reduce((e,[t,n])=>(e[t]=n,e),{}),B=w.length,J=(1<<B)-1,I=12287,$=[1<<m["[↑]"]|1<<m["[↓]"],1<<m["[←]"]|1<<m["[→]"],1<<m.Select|1<<m.Start|1<<m.L|1<<m.R];function A(e,t){return Number.isFinite(e)?t==="mask"?e&J:(e&I^I)&J:0}function j(e){const t=[];for(const[n,o]of w)(e&1<<o)!==0&&t.push(n);return t}function X(e){const t=A(e,"mask");for(const n of $)if((t&n)===n)return!0;return!1}function Q(e){const t=A(e,"code");return j(t)}function Z(e){const t=A(e,"mask"),n=[];for(let r=0;r<B;r+=1)(t&1<<r)!==0&&n.push(r);const o=[],h=1<<n.length;for(let r=0;r<h;r+=1){let a=0;for(let d=0;d<n.length;d+=1)(r&1<<d)!==0&&(a|=1<<n[d]);X(a)||o.push((a^I)>>>0)}return o}let u=null,T=null;async function ee(){return u||T||(T=(async()=>{try{const e=await import("./wasm_pkg-XwWEDZau.js");let t;if(typeof process<"u"&&!!process.versions?.node){const o=await import("./__vite-browser-external-9wXp6ZBx.js"),r=(await import("./__vite-browser-external-9wXp6ZBx.js")).join(process.cwd(),"src/wasm/wasm_pkg_bg.wasm");t={module_or_path:o.readFileSync(r)}}else t={module_or_path:new URL("/pokemon-gen5-initseed/assets/wasm_pkg_bg-yRRHAhfR.wasm",import.meta.url)};return await e.default(t),u={BWGenerationConfig:e.BWGenerationConfig,PokemonGenerator:e.PokemonGenerator,SeedEnumerator:e.SeedEnumerator,EncounterType:e.EncounterType,GameVersion:e.GameVersion,GameMode:e.GameMode,EggSeedEnumeratorJs:e.EggSeedEnumeratorJs,ParentsIVsJs:e.ParentsIVsJs,GenerationConditionsJs:e.GenerationConditionsJs,EverstonePlanJs:e.EverstonePlanJs,IndividualFilterJs:e.IndividualFilterJs,TrainerIds:e.TrainerIds,GenderRatio:e.GenderRatio,StatRange:e.StatRange,EggBootTimingSearchResult:e.EggBootTimingSearchResult,EggBootTimingSearchIterator:e.EggBootTimingSearchIterator,DSConfigJs:e.DSConfigJs,SegmentParamsJs:e.SegmentParamsJs,TimeRangeParamsJs:e.TimeRangeParamsJs,SearchRangeParamsJs:e.SearchRangeParamsJs,MtSeedBootTimingSearchIterator:e.MtSeedBootTimingSearchIterator,MtSeedBootTimingSearchResult:e.MtSeedBootTimingSearchResult,MtSeedBootTimingSearchResults:e.MtSeedBootTimingSearchResults,calculate_game_offset:e.calculate_game_offset,sha1_hash_batch:e.sha1_hash_batch},u}catch(e){throw console.error("Failed to load WebAssembly module:",e),u=null,T=null,e}})(),T)}function te(){if(!u)throw new Error("WebAssembly module not initialized. Call initWasm() first.");return u}function ne(){return u!==null}const oe={B:{JPN:{nazo:[35741456,35741708,35741708,35741784,35741784],vcountTimerRanges:[{vcount:96,timer0Min:3193,timer0Max:3194}]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[{vcount:96,timer0Min:3204,timer0Max:3205}]},USA:{nazo:[35741872,35742124,35742124,35742200,35742200],vcountTimerRanges:[{vcount:96,timer0Min:3195,timer0Max:3196}]},GER:{nazo:[35741680,35741932,35741932,35742008,35742008],vcountTimerRanges:[{vcount:95,timer0Min:3191,timer0Max:3192}]},FRA:{nazo:[35741744,35741996,35741996,35742072,35742072],vcountTimerRanges:[{vcount:95,timer0Min:3187,timer0Max:3188}]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[{vcount:96,timer0Min:3206,timer0Max:3207}]},ITA:{nazo:[35741616,35741868,35741868,35741944,35741944],vcountTimerRanges:[{vcount:95,timer0Min:3178,timer0Max:3179}]}},W:{JPN:{nazo:[35741488,35741740,35741740,35741816,35741816],vcountTimerRanges:[{vcount:95,timer0Min:3175,timer0Max:3177}]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[{vcount:96,timer0Min:3195,timer0Max:3196}]},USA:{nazo:[35741904,35742156,35742156,35742232,35742232],vcountTimerRanges:[{vcount:96,timer0Min:3198,timer0Max:3200}]},GER:{nazo:[35741712,35741964,35741964,35742040,35742040],vcountTimerRanges:[{vcount:96,timer0Min:3194,timer0Max:3195}]},FRA:{nazo:[35741776,35742028,35742028,35742104,35742104],vcountTimerRanges:[{vcount:95,timer0Min:3182,timer0Max:3183}]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[{vcount:95,timer0Min:3184,timer0Max:3185}]},ITA:{nazo:[35741648,35741900,35741900,35741976,35741976],vcountTimerRanges:[{vcount:96,timer0Min:3195,timer0Max:3196}]}},B2:{JPN:{nazo:[34187484,33790665,35649968,35650052,35650052],vcountTimerRanges:[{vcount:130,timer0Min:4354,timer0Max:4360}]},KOR:{nazo:[34190860,33793237,35653456,35653540,35653540],vcountTimerRanges:[{vcount:130,timer0Min:4335,timer0Max:4340}]},USA:{nazo:[34189032,33791465,35651600,35651684,35651684],vcountTimerRanges:[{vcount:130,timer0Min:4354,timer0Max:4360}]},GER:{nazo:[34188840,33791337,35651408,35651492,35651492],vcountTimerRanges:[{vcount:129,timer0Min:4325,timer0Max:4328},{vcount:130,timer0Min:4329,timer0Max:4332}]},FRA:{nazo:[34189064,33791481,35651632,35651716,35651716],vcountTimerRanges:[{vcount:130,timer0Min:4340,timer0Max:4344}]},SPA:{nazo:[34188968,33791417,35651536,35651620,35651620],vcountTimerRanges:[{vcount:130,timer0Min:4353,timer0Max:4358}]},ITA:{nazo:[34188776,33791337,35651344,35651428,35651428],vcountTimerRanges:[{vcount:130,timer0Min:4359,timer0Max:4361},{vcount:131,timer0Min:4361,timer0Max:4365}]}},W2:{JPN:{nazo:[34187516,33790709,3565e4,35650084,35650084],vcountTimerRanges:[{vcount:130,timer0Min:4341,timer0Max:4347}]},KOR:{nazo:[34190892,33793281,35653488,35653572,35653572],vcountTimerRanges:[{vcount:129,timer0Min:4324,timer0Max:4329}]},USA:{nazo:[34189096,33791509,35651664,35651748,35651748],vcountTimerRanges:[{vcount:130,timer0Min:4338,timer0Max:4342}]},GER:{nazo:[34188872,33791381,35651440,35651524,35651524],vcountTimerRanges:[{vcount:130,timer0Min:4325,timer0Max:4333}]},FRA:{nazo:[34189096,33791525,35651664,35651748,35651748],vcountTimerRanges:[{vcount:130,timer0Min:4332,timer0Max:4336}]},SPA:{nazo:[34189e3,33791461,35651568,35651652,35651652],vcountTimerRanges:[{vcount:130,timer0Min:4335,timer0Max:4340}]},ITA:{nazo:[34188840,33791381,35651408,35651492,35651492],vcountTimerRanges:[{vcount:130,timer0Min:4351,timer0Max:4356}]}}},s={params:null,running:!1,stopRequested:!1};function re(e,t,n){return new e.DSConfigJs(new Uint8Array(t.macAddress),new Uint32Array(n),t.hardware)}function ae(e,t,n,o){return new e.SegmentParamsJs(t,n,o)}function se(e,t){return new e.TimeRangeParamsJs(t.hour.start,t.hour.end,t.minute.start,t.minute.end,t.second.start,t.second.end)}function ie(e,t,n){return new e.SearchRangeParamsJs(t.getFullYear(),t.getMonth()+1,t.getDate(),n)}const b=self,l=e=>b.postMessage(e);l({type:"READY",version:"1"});b.onmessage=e=>{const t=e.data;(async()=>{try{switch(t.type){case"START_SEARCH":await ce(t.params);break;case"STOP":s.stopRequested=!0;break;default:break}}catch(n){const o=n instanceof Error?n.message:String(n);l({type:"ERROR",message:o,category:"RUNTIME",fatal:!1})}})()};async function ce(e){if(s.running)return;s.params=e,s.stopRequested=!1,s.running=!0;const t=performance.now();try{await me();const n=await ge(e,t),o={reason:s.stopRequested?"stopped":"completed",processedCombinations:n.processedSegments,totalCombinations:n.totalSegments,resultsCount:n.resultsCount,elapsedMs:performance.now()-t};l({type:"COMPLETE",payload:o})}catch(n){const o=n instanceof Error?n.message:String(n);l({type:"ERROR",message:o,category:"RUNTIME",fatal:!0})}finally{N()}}async function me(){ne()||await ee()}function ue(e,t){const n=oe[e];if(!n)throw new Error(`Unknown ROM version: ${e}`);const o=n[t];if(!o)throw new Error(`Unknown region for ${e}: ${t}`);return o.nazo}function de(e,t){return{boot:{datetime:new Date(Date.UTC(e.year,e.month-1,e.day,e.hour,e.minute,e.second)),timer0:e.timer0,vcount:e.vcount,keyCode:e.keyCode,keyInputNames:Q(e.keyCode),macAddress:t},mtSeedHex:e.mtSeedHex,mtSeed:e.mtSeed,lcgSeedHex:e.lcgSeedHex}}async function ge(e,t){const o=te();if(!o.MtSeedBootTimingSearchIterator)throw new Error("MtSeedBootTimingSearchIterator not exposed in WASM");const h=ue(e.romVersion,e.romRegion),r=Z(e.keyInputMask),{dateRange:a}=e,d=new Date(a.startYear,a.startMonth-1,a.startDay);let M;if(e.rangeSeconds!==void 0)M=e.rangeSeconds;else{const S=new Date(a.endYear,a.endMonth-1,a.endDay);M=Math.max(1,Math.floor((S.getTime()-d.getTime())/(1e3*60*60*24))+1)*24*60*60}const D=e.timer0Range.max-e.timer0Range.min+1,G=e.vcountRange.max-e.vcountRange.min+1,R=D*G*r.length,x=R*M,O=4,z=3600*24*5*R,U=500;let i=0,g=0,_=0,k=t;const K=new Uint32Array(e.targetSeeds);for(let S=e.timer0Range.min;S<=e.timer0Range.max&&i<e.maxResults;S++)for(let y=e.vcountRange.min;y<=e.vcountRange.max&&i<e.maxResults;y++)for(const F of r){if(s.stopRequested||i>=e.maxResults)return{resultsCount:i,processedSegments:g,totalSegments:R};const Y=re(o,e,h),L=ae(o,S,y,F),q=se(o,e.timeRange),H=ie(o,d,M);let p;try{p=new o.MtSeedBootTimingSearchIterator(Y,L,q,H,K)}catch(f){console.error("Failed to create MtSeedBootTimingSearchIterator:",f),g++;continue}try{let f=0;for(;!p.isFinished&&i<e.maxResults&&!s.stopRequested;){const E=p.next_batch(O,z).to_array();if(f=Math.min(f+z,M),E.length>0){const v=[];for(let c=0;c<E.length&&i<e.maxResults;c++){const P=E[c];v.push(de(P,e.macAddress)),i++}l({type:"RESULTS",payload:{results:v,batchIndex:g}})}const C=performance.now();if(C-k>=U){const v=C-t,c=_+f,P=x>0?c/x*100:0,V=c>0?v/c*(x-c):0;l({type:"PROGRESS",payload:{processedCombinations:g,totalCombinations:R,foundCount:i,progressPercent:P,elapsedMs:v,estimatedRemainingMs:V,processedSeconds:c}}),k=C}}}finally{p.free?.()}_+=M,g++}const W=performance.now()-t;return l({type:"PROGRESS",payload:{processedCombinations:g,totalCombinations:R,foundCount:i,progressPercent:100,elapsedMs:W,estimatedRemainingMs:0}}),{resultsCount:i,processedSegments:g,totalSegments:R}}function N(){s.running=!1,s.params=null,s.stopRequested=!1}b.onclose=()=>{N()};
