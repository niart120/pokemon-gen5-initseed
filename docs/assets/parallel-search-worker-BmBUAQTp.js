class x{calculateHash(e){if(e.length!==16)throw new Error("Message must be exactly 16 32-bit words (64 bytes)");const r=1732584193,o=4023233417,n=2562383102,s=271733878,c=3285377520,i=new Array(80);for(let u=0;u<16;u++)i[u]=e[u];for(let u=16;u<80;u++)i[u]=this.leftRotate(i[u-3]^i[u-8]^i[u-14]^i[u-16],1);let m=r,d=o,g=n,h=s,p=c;for(let u=0;u<80;u++){let S;u<20?S=this.leftRotate(m,5)+(d&g|~d&h)+p+i[u]+1518500249&4294967295:u<40?S=this.leftRotate(m,5)+(d^g^h)+p+i[u]+1859775393&4294967295:u<60?S=this.leftRotate(m,5)+(d&g|d&h|g&h)+p+i[u]+2400959708&4294967295:S=this.leftRotate(m,5)+(d^g^h)+p+i[u]+3395469782&4294967295,p=h,h=g,g=this.leftRotate(d,30),d=m,m=S}const y=this.add32(r,m),f=this.add32(o,d),T=this.add32(n,g),C=this.add32(s,h),M=this.add32(c,p);return{h0:y,h1:f,h2:T,h3:C,h4:M}}leftRotate(e,r){return(e<<r|e>>>32-r)>>>0}add32(e,r){return(e+r&4294967295)>>>0}static hashToHex(e,r,o,n,s){return e.toString(16).padStart(8,"0")+r.toString(16).padStart(8,"0")+o.toString(16).padStart(8,"0")+n.toString(16).padStart(8,"0")+s.toString(16).padStart(8,"0")}}let b=null,v=null;async function J(){return b||v||(v=(async()=>{try{const t=await import("./wasm_pkg-LLJoKDnj.js");let e;if(typeof process<"u"&&!!process.versions?.node){const o=await import("./__vite-browser-external-9wXp6ZBx.js"),s=(await import("./__vite-browser-external-9wXp6ZBx.js")).join(process.cwd(),"src/wasm/wasm_pkg_bg.wasm");e={module_or_path:o.readFileSync(s)}}else e={module_or_path:new URL("/pokemon-gen5-initseed/assets/wasm_pkg_bg-CRJRJ3QB.wasm",import.meta.url)};return await t.default(e),b={IntegratedSeedSearcher:t.IntegratedSeedSearcher,BWGenerationConfig:t.BWGenerationConfig,PokemonGenerator:t.PokemonGenerator,SeedEnumerator:t.SeedEnumerator,EncounterType:t.EncounterType,GameVersion:t.GameVersion,GameMode:t.GameMode,calculate_game_offset:t.calculate_game_offset,sha1_hash_batch:t.sha1_hash_batch},b}catch(t){throw console.error("Failed to load WebAssembly module:",t),b=null,v=null,t}})(),v)}function j(){if(!b)throw new Error("WebAssembly module not initialized. Call initWasm() first.");return b}function L(){return b!==null}const q={B:{JPN:{nazo:[35741456,35741708,35741708,35741784,35741784],vcountTimerRanges:[[96,3193,3194]]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[[96,3204,3205]]},USA:{nazo:[35741872,35742124,35742124,35742200,35742200],vcountTimerRanges:[[96,3195,3196]]},GER:{nazo:[35741680,35741932,35741932,35742008,35742008],vcountTimerRanges:[[95,3191,3192]]},FRA:{nazo:[35741744,35741996,35741996,35742072,35742072],vcountTimerRanges:[[95,3187,3188]]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[[96,3206,3207]]},ITA:{nazo:[35741616,35741868,35741868,35741944,35741944],vcountTimerRanges:[[95,3178,3179]]}},W:{JPN:{nazo:[35741488,35741740,35741740,35741816,35741816],vcountTimerRanges:[[95,3175,3177]]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[[96,3195,3196]]},USA:{nazo:[35741904,35742156,35742156,35742232,35742232],vcountTimerRanges:[[96,3198,3200]]},GER:{nazo:[35741712,35741964,35741964,35742040,35742040],vcountTimerRanges:[[96,3194,3195]]},FRA:{nazo:[35741776,35742028,35742028,35742104,35742104],vcountTimerRanges:[[95,3182,3183]]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[[95,3184,3185]]},ITA:{nazo:[35741648,35741900,35741900,35741976,35741976],vcountTimerRanges:[[96,3195,3196]]}},B2:{JPN:{nazo:[34187484,33790665,35649968,35650052,35650052],vcountTimerRanges:[[130,4354,4360]]},KOR:{nazo:[34190860,33793237,35653456,35653540,35653540],vcountTimerRanges:[[130,4335,4340]]},USA:{nazo:[34189032,33791465,35651600,35651684,35651684],vcountTimerRanges:[[130,4354,4360]]},GER:{nazo:[34188840,33791337,35651408,35651492,35651492],vcountTimerRanges:[[129,4325,4328],[130,4329,4332]]},FRA:{nazo:[34189064,33791481,35651632,35651716,35651716],vcountTimerRanges:[[130,4340,4344]]},SPA:{nazo:[34188968,33791417,35651536,35651620,35651620],vcountTimerRanges:[[130,4353,4358]]},ITA:{nazo:[34188776,33791337,35651344,35651428,35651428],vcountTimerRanges:[[130,4359,4361],[131,4361,4365]]}},W2:{JPN:{nazo:[34187516,33790709,3565e4,35650084,35650084],vcountTimerRanges:[[130,4341,4347]]},KOR:{nazo:[34190892,33793281,35653488,35653572,35653572],vcountTimerRanges:[[129,4324,4329]]},USA:{nazo:[34189096,33791509,35651664,35651748,35651748],vcountTimerRanges:[[130,4338,4342]]},GER:{nazo:[34188872,33791381,35651440,35651524,35651524],vcountTimerRanges:[[130,4325,4333]]},FRA:{nazo:[34189096,33791525,35651664,35651748,35651748],vcountTimerRanges:[[130,4332,4336]]},SPA:{nazo:[34189e3,33791461,35651568,35651652,35651652],vcountTimerRanges:[[130,4335,4340]]},ITA:{nazo:[34188840,33791381,35651408,35651492,35651492],vcountTimerRanges:[[130,4351,4356]]}}},B=[["A",0],["B",1],["Select",2],["Start",3],["[→]",4],["[←]",5],["[↑]",6],["[↓]",7],["R",8],["L",9],["X",10],["Y",11]],A=B.reduce((t,[e,r])=>(t[e]=r,t),{}),H=B.length,Q=(1<<H)-1,X=12287,Z=[1<<A["[↑]"]|1<<A["[↓]"],1<<A["[←]"]|1<<A["[→]"],1<<A.Select|1<<A.Start|1<<A.L|1<<A.R];function F(t,e){return Number.isFinite(t)?t&Q:0}function ee(t){const e=F(t);return X^e}function te(t){const e=F(t);for(const r of Z)if((e&r)===r)return!0;return!1}function K(t){return ee(t)}function $(t){const e=F(t),r=[];for(let s=0;s<H;s+=1)(e&1<<s)!==0&&r.push(s);const o=1<<r.length;let n=0;for(let s=0;s<o;s+=1){let c=0;for(let i=0;i<r.length;i+=1)(s&1<<i)!==0&&(c|=1<<r[i]);te(c)||(n+=1)}return n>0?n:1}const re={DS:8,DS_LITE:6,"3DS":9};class ne{sha1;useWasm=!1;constructor(){this.sha1=new x}async initializeWasm(){try{return await J(),this.useWasm=!0,!0}catch(e){return console.warn("WebAssembly initialization failed, falling back to TypeScript:",e),this.useWasm=!1,!1}}isUsingWasm(){return this.useWasm&&L()}getWasmModule(){return j()}setUseWasm(e){if(e&&!L()){console.warn("Cannot enable WebAssembly: module not initialized");return}this.useWasm=e}getROMParameters(e,r){const o=q[e];if(!o)return console.error(`ROM version not found: ${e}`),null;const n=o[r];return n?{nazo:[...n.nazo],vcountTimerRanges:n.vcountTimerRanges.map(s=>[...s])}:(console.error(`ROM region not found: ${r} for version ${e}`),null)}toLittleEndian32(e){return((e&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255)>>>0}toLittleEndian16(e){return(e&255)<<8|e>>>8&255}getDayOfWeek(e,r,o){return new Date(e,r-1,o).getDay()}generateMessage(e,r,o,n,s){const c=this.getROMParameters(e.romVersion,e.romRegion);if(!c)throw new Error(`No parameters found for ${e.romVersion} ${e.romRegion}`);const i=new Array(16).fill(0);for(let l=0;l<5;l++)i[l]=this.toLittleEndian32(c.nazo[l]);i[5]=this.toLittleEndian32(o<<16|r);const m=e.macAddress[4]<<8|e.macAddress[5];i[6]=m;const d=e.macAddress[0]<<0|e.macAddress[1]<<8|e.macAddress[2]<<16|e.macAddress[3]<<24,g=100663296,h=re[e.hardware],p=d^g^h;i[7]=this.toLittleEndian32(p);const y=n.getFullYear()%100,f=n.getMonth()+1,T=n.getDate(),C=this.getDayOfWeek(n.getFullYear(),f,T),M=Math.floor(y/10)*16+y%10,u=Math.floor(f/10)*16+f%10,S=Math.floor(T/10)*16+T%10,P=Math.floor(C/10)*16+C%10;i[8]=M<<24|u<<16|S<<8|P;const E=n.getHours(),w=n.getMinutes(),I=n.getSeconds(),z=(e.hardware==="DS"||e.hardware==="DS_LITE")&&E>=12?1:0,D=Math.floor(E/10)*16+E%10,W=Math.floor(w/10)*16+w%10,O=Math.floor(I/10)*16+I%10;i[9]=z<<30|D<<24|W<<16|O<<8|0,i[10]=0,i[11]=0;const V=s??K(e.keyInput);return i[12]=this.toLittleEndian32(V),i[13]=2147483648,i[14]=0,i[15]=416,i}calculateSeed(e){const r=this.sha1.calculateHash(e),o=BigInt(this.toLittleEndian32(r.h0)),s=BigInt(this.toLittleEndian32(r.h1))<<32n|o,m=s*0x5D588B656C078965n+0x269EC3n;return{seed:Number(m>>32n&0xFFFFFFFFn),hash:x.hashToHex(r.h0,r.h1,r.h2,r.h3,r.h4),lcgSeed:s}}parseTargetSeeds(e){const r=e.split(`
`).map(c=>c.trim()).filter(c=>c.length>0),o=[],n=[],s=new Set;return r.forEach((c,i)=>{try{let m=c.toLowerCase();if(m.startsWith("0x")&&(m=m.substring(2)),!/^[0-9a-f]{1,8}$/.test(m)){n.push({line:i+1,value:c,error:"Invalid hexadecimal format. Expected 1-8 hex digits."});return}const d=parseInt(m,16);if(s.has(d))return;s.add(d),o.push(d)}catch(m){const d=m instanceof Error?m.message:String(m);n.push({line:i+1,value:c,error:d||"Failed to parse as hexadecimal number."})}}),{validSeeds:o,errors:n}}getVCountForTimer0(e,r){for(const[o,n,s]of e.vcountTimerRanges)if(r>=n&&r<=s)return o;return e.vcountTimerRanges.length>0?e.vcountTimerRanges[0][0]:96}}function ae(t){const e=new Uint8Array(6);for(let r=0;r<6;r++){const o=t[r]??0;let n;if(typeof o=="number")n=o;else{const s=o.trim().toLowerCase();n=s.startsWith("0x")||Number.isNaN(Number(s))?parseInt(s,16):Number(s)}Number.isFinite(n)||(n=0),n=Math.min(255,Math.max(0,Math.trunc(n))),e[r]=n}return e}const a={isRunning:!1,isPaused:!1,shouldStop:!1,workerId:-1,chunk:null,startTime:0},R={cumulativeRunTime:0,segmentStartTime:0,isPaused:!1};let k;const se=1e6;function oe(){R.cumulativeRunTime=0,R.segmentStartTime=Date.now(),R.isPaused=!1}function ie(){R.isPaused||(R.cumulativeRunTime+=Date.now()-R.segmentStartTime,R.isPaused=!0)}function ue(){R.isPaused&&(R.segmentStartTime=Date.now(),R.isPaused=!1)}function ce(){return R.isPaused?R.cumulativeRunTime:R.cumulativeRunTime+(Date.now()-R.segmentStartTime)}async function me(){if(!k){k=new ne;try{await k.initializeWasm()}catch(t){console.warn(`Worker ${a.workerId}: WebAssembly failed, using TypeScript fallback:`,t)}}}async function le(t,e){if(!a.chunk)throw new Error("No chunk assigned to worker");a.startTime=Date.now();let r=0;try{if(k.isUsingWasm()){const o=await de(t,e);r=o.length;for(const n of o)postMessage({type:"RESULT",workerId:a.workerId,result:{...n,datetime:n.datetime.toISOString()}})}else r=await he(t,e);postMessage({type:"COMPLETE",workerId:a.workerId,message:`Worker ${a.workerId} completed with ${r} matches`})}catch(o){console.error(`❌ Worker ${a.workerId}: Processing error:`,o),postMessage({type:"ERROR",workerId:a.workerId,error:o instanceof Error?o.message:"Unknown error"})}}async function de(t,e){const r=k.getWasmModule(),o=k.getROMParameters(t.romVersion,t.romRegion);if(!o)throw new Error(`No ROM parameters found for ${t.romVersion} ${t.romRegion}`);const s={DS:8,DS_LITE:6,"3DS":9}[t.hardware]||8,c=new r.IntegratedSeedSearcher(ae(t.macAddress),new Uint32Array(o.nazo),t.hardware,t.keyInput,s),i=e.length>0?new Uint32Array(e):new Uint32Array(0),m=$(t.keyInput),d=t.timer0VCountConfig.timer0Range.max-t.timer0VCountConfig.timer0Range.min+1,g=t.timer0VCountConfig.vcountRange.max-t.timer0VCountConfig.vcountRange.min+1,h=d*g*Math.max(m,1);try{const p=a.chunk,y=p.startDateTime,f=p.endDateTime,T=Math.floor((f.getTime()-y.getTime())/1e3)+1,C=T*h;_(0,C,0);const M=Math.floor(se/Math.max(h,1)),u=Math.max(1,M),S=Math.max(1,Math.min(T,Math.min(7200*60,u))),P=[];let E=0;for(let w=0;w<T&&!a.shouldStop;w+=S){if(a.isPaused){for(postMessage({type:"PAUSED",workerId:a.workerId});a.isPaused&&!a.shouldStop;)await new Promise(l=>setTimeout(l,100));a.shouldStop||postMessage({type:"RESUMED",workerId:a.workerId})}if(a.shouldStop)break;const I=new Date(y.getTime()+w*1e3),z=new Date(Math.min(y.getTime()+(w+S)*1e3,f.getTime()+1e3)),D=Math.floor((z.getTime()-I.getTime())/1e3);if(D<=0)break;if(await new Promise(l=>setTimeout(l,0)),a.isPaused){for(;a.isPaused&&!a.shouldStop;)await new Promise(l=>setTimeout(l,100));if(a.shouldStop)break}const W=c.search_seeds_integrated_simd(I.getFullYear(),I.getMonth()+1,I.getDate(),I.getHours(),I.getMinutes(),I.getSeconds(),D,t.timer0VCountConfig.timer0Range.min,t.timer0VCountConfig.timer0Range.max,t.timer0VCountConfig.vcountRange.min,t.timer0VCountConfig.vcountRange.max,i);await new Promise(l=>setTimeout(l,0));const O=W;for(const l of O){const U=new Date(l.year,l.month-1,l.date,l.hour,l.minute,l.second),N=k.generateMessage(t,l.timer0,l.vcount,U,l.keyCode),{hash:G,lcgSeed:Y}=k.calculateSeed(N);P.push({seed:l.seed,datetime:U,timer0:l.timer0,vcount:l.vcount,keyCode:l.keyCode??null,conditions:t,message:N,sha1Hash:G,lcgSeed:Y,isMatch:!0})}const V=D*h;E+=V,_(E,C,P.length)}return P}finally{c.free()}}async function he(t,e){const r=a.chunk,o=new Set(e);let n=0,s=0,c=0;const i=K(t.keyInput),m=$(t.keyInput),d=k.getROMParameters(t.romVersion,t.romRegion);if(!d)throw new Error(`No ROM parameters found for ${t.romVersion} ${t.romRegion}`);const g=r.startDateTime.getTime(),h=r.endDateTime.getTime(),y=(Math.floor((h-g)/1e3)+1)*(t.timer0VCountConfig.timer0Range.max-t.timer0VCountConfig.timer0Range.min+1)*Math.max(m,1);for(let f=t.timer0VCountConfig.timer0Range.min;f<=t.timer0VCountConfig.timer0Range.max&&!a.shouldStop;f++){const T=k.getVCountForTimer0(d,f);for(let C=g;C<=h&&!a.shouldStop;C+=1e3){for(;a.isPaused&&!a.shouldStop;)await new Promise(u=>setTimeout(u,100));if(a.shouldStop)break;const M=new Date(C);try{const u=k.generateMessage(t,f,T,M,i),{seed:S,hash:P,lcgSeed:E}=k.calculateSeed(u);if(o.has(S)){const w={seed:S,datetime:M,timer0:f,vcount:T,keyCode:i,conditions:t,message:u,sha1Hash:P,lcgSeed:E,isMatch:!0};postMessage({type:"RESULT",workerId:a.workerId,result:{...w,datetime:w.datetime.toISOString()}}),n++}if(s+=m,c+=m,c>=1e3){if(_(s,y,n),c=0,a.isPaused)for(;a.isPaused&&!a.shouldStop;)await new Promise(w=>setTimeout(w,100));await new Promise(w=>setTimeout(w,0))}}catch(u){console.error(`Worker ${a.workerId}: Error calculating seed:`,u)}}}return _(s,y,n),n}function _(t,e,r){const o=ce(),n=t/e,s=n>0?Math.round(o/n*(1-n)):0;postMessage({type:"PROGRESS",workerId:a.workerId,progress:{currentStep:t,totalSteps:e,elapsedTime:o,estimatedTimeRemaining:s,matchesFound:r,currentDateTime:a.chunk?.startDateTime.toISOString()}})}self.onmessage=async t=>{const{type:e,conditions:r,targetSeeds:o,workerId:n,chunk:s}=t.data;switch(n!==void 0&&(a.workerId=n),e){case"START_SEARCH":if(!r||!o||!s){postMessage({type:"ERROR",workerId:a.workerId,error:"Missing required parameters for search"});return}a.chunk=s,a.isRunning=!0,a.shouldStop=!1,a.isPaused=!1,oe();try{await me(),await le(r,o)}catch(c){postMessage({type:"ERROR",workerId:a.workerId,error:c instanceof Error?c.message:"Unknown error"})}finally{a.isRunning=!1}break;case"PAUSE_SEARCH":a.isPaused=!0,ie(),postMessage({type:"PAUSED",workerId:a.workerId});break;case"RESUME_SEARCH":a.isPaused=!1,ue(),postMessage({type:"RESUMED",workerId:a.workerId});break;case"STOP_SEARCH":a.shouldStop=!0,a.isRunning=!1,postMessage({type:"STOPPED",workerId:a.workerId});break;case"PING":postMessage({type:"INITIALIZED",workerId:a.workerId,message:`Pong from worker ${a.workerId}`});break}};postMessage({type:"READY",workerId:a.workerId,message:`Parallel worker ${a.workerId} initialized`});
