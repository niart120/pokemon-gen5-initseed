var _=Object.defineProperty;var U=(r,e,t)=>e in r?_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var W=(r,e,t)=>U(r,typeof e!="symbol"?e+"":e,t);class z{calculateHash(e){if(e.length!==16)throw new Error("Message must be exactly 16 32-bit words (64 bytes)");const t=1732584193,n=4023233417,s=2562383102,u=271733878,o=3285377520,c=new Array(80);for(let i=0;i<16;i++)c[i]=e[i];for(let i=16;i<80;i++)c[i]=this.leftRotate(c[i-3]^c[i-8]^c[i-14]^c[i-16],1);let m=t,g=n,h=s,d=u,w=o;for(let i=0;i<80;i++){let y;i<20?y=this.leftRotate(m,5)+(g&h|~g&d)+w+c[i]+1518500249&4294967295:i<40?y=this.leftRotate(m,5)+(g^h^d)+w+c[i]+1859775393&4294967295:i<60?y=this.leftRotate(m,5)+(g&h|g&d|h&d)+w+c[i]+2400959708&4294967295:y=this.leftRotate(m,5)+(g^h^d)+w+c[i]+3395469782&4294967295,w=d,d=h,h=this.leftRotate(g,30),g=m,m=y}const S=this.add32(t,m),k=this.add32(n,g),f=this.add32(s,h),R=this.add32(u,d),C=this.add32(o,w);return{h0:S,h1:k,h2:f,h3:R,h4:C}}leftRotate(e,t){return(e<<t|e>>>32-t)>>>0}add32(e,t){return(e+t&4294967295)>>>0}static hashToHex(e,t,n,s,u){return e.toString(16).padStart(8,"0")+t.toString(16).padStart(8,"0")+n.toString(16).padStart(8,"0")+s.toString(16).padStart(8,"0")+u.toString(16).padStart(8,"0")}}let E=null,A=null;async function L(){return E||A||(A=(async()=>{var r;try{const e=await import("./wasm_pkg-jFzOl2GZ.js");let t;if(typeof process<"u"&&!!((r=process.versions)!=null&&r.node)){const s=await import("./__vite-browser-external-9wXp6ZBx.js"),o=(await import("./__vite-browser-external-9wXp6ZBx.js")).join(process.cwd(),"src/wasm/wasm_pkg_bg.wasm");t={module_or_path:s.readFileSync(o)}}else t={module_or_path:new URL("/pokemon-gen5-initseed/assets/wasm_pkg_bg-DmY2UIoS.wasm",import.meta.url)};return await e.default(t),E={IntegratedSeedSearcher:e.IntegratedSeedSearcher,BWGenerationConfig:e.BWGenerationConfig,PokemonGenerator:e.PokemonGenerator,SeedEnumerator:e.SeedEnumerator,EncounterType:e.EncounterType,GameVersion:e.GameVersion,GameMode:e.GameMode,calculate_game_offset:e.calculate_game_offset},E}catch(e){throw console.error("Failed to load WebAssembly module:",e),E=null,A=null,e}})(),A)}function x(){if(!E)throw new Error("WebAssembly module not initialized. Call initWasm() first.");return E}function V(){return E!==null}const H={B:{JPN:{nazo:[35741456,35741708,35741708,35741784,35741784],vcountTimerRanges:[[96,3193,3194]]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[[96,3204,3205]]},USA:{nazo:[35741872,35742124,35742124,35742200,35742200],vcountTimerRanges:[[96,3195,3196]]},GER:{nazo:[35741680,35741932,35741932,35742008,35742008],vcountTimerRanges:[[95,3191,3192]]},FRA:{nazo:[35741744,35741996,35741996,35742072,35742072],vcountTimerRanges:[[95,3187,3188]]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[[96,3206,3207]]},ITA:{nazo:[35741616,35741868,35741868,35741944,35741944],vcountTimerRanges:[[95,3178,3179]]}},W:{JPN:{nazo:[35741488,35741740,35741740,35741816,35741816],vcountTimerRanges:[[95,3175,3177]]},KOR:{nazo:[35743664,35743916,35743916,35743992,35743992],vcountTimerRanges:[[96,3195,3196]]},USA:{nazo:[35741904,35742156,35742156,35742232,35742232],vcountTimerRanges:[[96,3198,3200]]},GER:{nazo:[35741712,35741964,35741964,35742040,35742040],vcountTimerRanges:[[96,3194,3195]]},FRA:{nazo:[35741776,35742028,35742028,35742104,35742104],vcountTimerRanges:[[95,3182,3183]]},SPA:{nazo:[35741808,35742060,35742060,35742136,35742136],vcountTimerRanges:[[95,3184,3185]]},ITA:{nazo:[35741648,35741900,35741900,35741976,35741976],vcountTimerRanges:[[96,3195,3196]]}},B2:{JPN:{nazo:[34187484,33790665,35649968,35650052,35650052],vcountTimerRanges:[[130,4354,4360]]},KOR:{nazo:[34190860,33793237,35653456,35653540,35653540],vcountTimerRanges:[[130,4335,4340]]},USA:{nazo:[34189032,33791465,35651600,35651684,35651684],vcountTimerRanges:[[130,4354,4360]]},GER:{nazo:[34188840,33791337,35651408,35651492,35651492],vcountTimerRanges:[[129,4325,4328],[130,4329,4332]]},FRA:{nazo:[34189064,33791481,35651632,35651716,35651716],vcountTimerRanges:[[130,4340,4344]]},SPA:{nazo:[34188968,33791417,35651536,35651620,35651620],vcountTimerRanges:[[130,4353,4358]]},ITA:{nazo:[34188776,33791337,35651344,35651428,35651428],vcountTimerRanges:[[130,4359,4361],[131,4361,4365]]}},W2:{JPN:{nazo:[34187516,33790709,3565e4,35650084,35650084],vcountTimerRanges:[[130,4341,4347]]},KOR:{nazo:[34190892,33793281,35653488,35653572,35653572],vcountTimerRanges:[[129,4324,4329]]},USA:{nazo:[34189096,33791509,35651664,35651748,35651748],vcountTimerRanges:[[130,4338,4342]]},GER:{nazo:[34188872,33791381,35651440,35651524,35651524],vcountTimerRanges:[[130,4325,4333]]},FRA:{nazo:[34189096,33791525,35651664,35651748,35651748],vcountTimerRanges:[[130,4332,4336]]},SPA:{nazo:[34189e3,33791461,35651568,35651652,35651652],vcountTimerRanges:[[130,4335,4340]]},ITA:{nazo:[34188840,33791381,35651408,35651492,35651492],vcountTimerRanges:[[130,4351,4356]]}}},N={DS:8,DS_LITE:6,"3DS":9};class ${constructor(){W(this,"sha1");W(this,"useWasm",!1);this.sha1=new z}async initializeWasm(){try{return await L(),this.useWasm=!0,!0}catch(e){return console.warn("WebAssembly initialization failed, falling back to TypeScript:",e),this.useWasm=!1,!1}}isUsingWasm(){return this.useWasm&&V()}getWasmModule(){return x()}setUseWasm(e){if(e&&!V()){console.warn("Cannot enable WebAssembly: module not initialized");return}this.useWasm=e}getROMParameters(e,t){const n=H[e];if(!n)return console.error(`ROM version not found: ${e}`),null;const s=n[t];return s?{nazo:[...s.nazo],vcountTimerRanges:s.vcountTimerRanges.map(u=>[...u])}:(console.error(`ROM region not found: ${t} for version ${e}`),null)}toLittleEndian32(e){return((e&255)<<24|(e>>>8&255)<<16|(e>>>16&255)<<8|e>>>24&255)>>>0}toLittleEndian16(e){return(e&255)<<8|e>>>8&255}getDayOfWeek(e,t,n){return new Date(e,t-1,n).getDay()}generateMessage(e,t,n,s){const u=this.getROMParameters(e.romVersion,e.romRegion);if(!u)throw new Error(`No parameters found for ${e.romVersion} ${e.romRegion}`);const o=new Array(16).fill(0);for(let D=0;D<5;D++)o[D]=this.toLittleEndian32(u.nazo[D]);o[5]=this.toLittleEndian32(n<<16|t);const c=e.macAddress[4]<<8|e.macAddress[5];o[6]=c;const m=e.macAddress[0]<<0|e.macAddress[1]<<8|e.macAddress[2]<<16|e.macAddress[3]<<24,g=100663296,h=N[e.hardware],d=m^g^h;o[7]=this.toLittleEndian32(d);const w=s.getFullYear()%100,S=s.getMonth()+1,k=s.getDate(),f=this.getDayOfWeek(s.getFullYear(),S,k),R=Math.floor(w/10)*16+w%10,C=Math.floor(S/10)*16+S%10,i=Math.floor(k/10)*16+k%10,y=Math.floor(f/10)*16+f%10;o[8]=R<<24|C<<16|i<<8|y;const M=s.getHours(),l=s.getMinutes(),I=s.getSeconds(),P=(e.hardware==="DS"||e.hardware==="DS_LITE")&&M>=12?1:0,b=Math.floor(M/10)*16+M%10,O=Math.floor(l/10)*16+l%10,F=Math.floor(I/10)*16+I%10;return o[9]=P<<30|b<<24|O<<16|F<<8|0,o[10]=0,o[11]=0,o[12]=this.toLittleEndian32(e.keyInput),o[13]=2147483648,o[14]=0,o[15]=416,o}calculateSeed(e){const t=this.sha1.calculateHash(e),n=BigInt(this.toLittleEndian32(t.h0)),m=(BigInt(this.toLittleEndian32(t.h1))<<32n|n)*0x5D588B656C078965n+0x269EC3n;return{seed:Number(m>>32n&0xFFFFFFFFn),hash:z.hashToHex(t.h0,t.h1,t.h2,t.h3,t.h4)}}parseTargetSeeds(e){const t=e.split(`
`).map(o=>o.trim()).filter(o=>o.length>0),n=[],s=[],u=new Set;return t.forEach((o,c)=>{try{let m=o.toLowerCase();if(m.startsWith("0x")&&(m=m.substring(2)),!/^[0-9a-f]{1,8}$/.test(m)){s.push({line:c+1,value:o,error:"Invalid hexadecimal format. Expected 1-8 hex digits."});return}const g=parseInt(m,16);if(u.has(g))return;u.add(g),n.push(g)}catch(m){const g=m instanceof Error?m.message:String(m);s.push({line:c+1,value:o,error:g||"Failed to parse as hexadecimal number."})}}),{validSeeds:n,errors:s}}getVCountForTimer0(e,t){for(const[n,s,u]of e.vcountTimerRanges)if(t>=s&&t<=u)return n;return e.vcountTimerRanges.length>0?e.vcountTimerRanges[0][0]:96}}function B(r){const e=new Uint8Array(6);for(let t=0;t<6;t++){const n=r[t]??0;let s;if(typeof n=="number")s=n;else{const u=n.trim().toLowerCase();s=u.startsWith("0x")||Number.isNaN(Number(u))?parseInt(u,16):Number(u)}Number.isFinite(s)||(s=0),s=Math.min(255,Math.max(0,Math.trunc(s))),e[t]=s}return e}const a={isRunning:!1,isPaused:!1,shouldStop:!1,workerId:-1,chunk:null,startTime:0},p={cumulativeRunTime:0,segmentStartTime:0,isPaused:!1};let T;function G(){p.cumulativeRunTime=0,p.segmentStartTime=Date.now(),p.isPaused=!1}function Y(){p.isPaused||(p.cumulativeRunTime+=Date.now()-p.segmentStartTime,p.isPaused=!0)}function J(){p.isPaused&&(p.segmentStartTime=Date.now(),p.isPaused=!1)}function K(){return p.isPaused?p.cumulativeRunTime:p.cumulativeRunTime+(Date.now()-p.segmentStartTime)}async function j(){if(!T){T=new $;try{await T.initializeWasm()}catch(r){console.warn(`Worker ${a.workerId}: WebAssembly failed, using TypeScript fallback:`,r)}}}async function q(r,e){if(!a.chunk)throw new Error("No chunk assigned to worker");a.startTime=Date.now();let t=0;try{if(T.isUsingWasm()){const n=await Z(r,e);t=n.length;for(const s of n)postMessage({type:"RESULT",workerId:a.workerId,result:{...s,datetime:s.datetime.toISOString()}})}else t=await Q(r,e);postMessage({type:"COMPLETE",workerId:a.workerId,message:`Worker ${a.workerId} completed with ${t} matches`})}catch(n){console.error(`âŒ Worker ${a.workerId}: Processing error:`,n),postMessage({type:"ERROR",workerId:a.workerId,error:n instanceof Error?n.message:"Unknown error"})}}async function Z(r,e){const t=T.getWasmModule(),n=T.getROMParameters(r.romVersion,r.romRegion);if(!n)throw new Error(`No ROM parameters found for ${r.romVersion} ${r.romRegion}`);const u={DS:8,DS_LITE:6,"3DS":9}[r.hardware]||8,o=new t.IntegratedSeedSearcher(B(r.macAddress),new Uint32Array(n.nazo),r.hardware,r.keyInput,u);try{const c=a.chunk,m=c.startDateTime,g=c.endDateTime,h=Math.floor((g.getTime()-m.getTime())/1e3)+1,d=h*(r.timer0VCountConfig.timer0Range.max-r.timer0VCountConfig.timer0Range.min+1)*(r.timer0VCountConfig.vcountRange.max-r.timer0VCountConfig.vcountRange.min+1);v(0,d,0);const w=Math.min(7200*60,h),S=[];let k=0;for(let f=0;f<h&&!a.shouldStop;f+=w){if(a.isPaused){for(postMessage({type:"PAUSED",workerId:a.workerId});a.isPaused&&!a.shouldStop;)await new Promise(l=>setTimeout(l,100));a.shouldStop||postMessage({type:"RESUMED",workerId:a.workerId})}if(a.shouldStop)break;const R=new Date(m.getTime()+f*1e3),C=new Date(Math.min(m.getTime()+(f+w)*1e3,g.getTime()+1e3)),i=Math.floor((C.getTime()-R.getTime())/1e3);if(i<=0)break;if(await new Promise(l=>setTimeout(l,0)),a.isPaused){for(;a.isPaused&&!a.shouldStop;)await new Promise(l=>setTimeout(l,100));if(a.shouldStop)break}const y=o.search_seeds_integrated_simd(R.getFullYear(),R.getMonth()+1,R.getDate(),R.getHours(),R.getMinutes(),R.getSeconds(),i,r.timer0VCountConfig.timer0Range.min,r.timer0VCountConfig.timer0Range.max,r.timer0VCountConfig.vcountRange.min,r.timer0VCountConfig.vcountRange.max,new Uint32Array(e));await new Promise(l=>setTimeout(l,0));for(const l of y){const I=new Date(l.year,l.month-1,l.date,l.hour,l.minute,l.second),P=T.generateMessage(r,l.timer0,l.vcount,I),{hash:b}=T.calculateSeed(P);S.push({seed:l.seed,datetime:I,timer0:l.timer0,vcount:l.vcount,conditions:r,message:P,sha1Hash:b,isMatch:!0})}const M=i*(r.timer0VCountConfig.timer0Range.max-r.timer0VCountConfig.timer0Range.min+1)*(r.timer0VCountConfig.vcountRange.max-r.timer0VCountConfig.vcountRange.min+1);k+=M,v(k,d,S.length)}return S}finally{o.free()}}async function Q(r,e){const t=a.chunk,n=new Set(e);let s=0,u=0;const o=T.getROMParameters(r.romVersion,r.romRegion);if(!o)throw new Error(`No ROM parameters found for ${r.romVersion} ${r.romRegion}`);const c=t.startDateTime.getTime(),m=t.endDateTime.getTime(),h=(Math.floor((m-c)/1e3)+1)*(r.timer0VCountConfig.timer0Range.max-r.timer0VCountConfig.timer0Range.min+1);for(let d=r.timer0VCountConfig.timer0Range.min;d<=r.timer0VCountConfig.timer0Range.max&&!a.shouldStop;d++){const w=T.getVCountForTimer0(o,d);for(let S=c;S<=m&&!a.shouldStop;S+=1e3){for(;a.isPaused&&!a.shouldStop;)await new Promise(f=>setTimeout(f,100));if(a.shouldStop)break;const k=new Date(S);try{const f=T.generateMessage(r,d,w,k),{seed:R,hash:C}=T.calculateSeed(f);if(n.has(R)){const i={seed:R,datetime:k,timer0:d,vcount:w,conditions:r,message:f,sha1Hash:C,isMatch:!0};postMessage({type:"RESULT",workerId:a.workerId,result:{...i,datetime:i.datetime.toISOString()}}),s++}if(u++,u%1e3===0){if(v(u,h,s),a.isPaused)for(;a.isPaused&&!a.shouldStop;)await new Promise(i=>setTimeout(i,100));await new Promise(i=>setTimeout(i,0))}}catch(f){console.error(`Worker ${a.workerId}: Error calculating seed:`,f)}}}return v(u,h,s),s}function v(r,e,t){var o;const n=K(),s=r/e,u=s>0?Math.round(n/s*(1-s)):0;postMessage({type:"PROGRESS",workerId:a.workerId,progress:{currentStep:r,totalSteps:e,elapsedTime:n,estimatedTimeRemaining:u,matchesFound:t,currentDateTime:(o=a.chunk)==null?void 0:o.startDateTime.toISOString()}})}self.onmessage=async r=>{const{type:e,conditions:t,targetSeeds:n,workerId:s,chunk:u}=r.data;switch(s!==void 0&&(a.workerId=s),e){case"START_SEARCH":if(!t||!n||!u){postMessage({type:"ERROR",workerId:a.workerId,error:"Missing required parameters for search"});return}a.chunk=u,a.isRunning=!0,a.shouldStop=!1,a.isPaused=!1,G();try{await j(),await q(t,n)}catch(o){postMessage({type:"ERROR",workerId:a.workerId,error:o instanceof Error?o.message:"Unknown error"})}finally{a.isRunning=!1}break;case"PAUSE_SEARCH":a.isPaused=!0,Y(),postMessage({type:"PAUSED",workerId:a.workerId});break;case"RESUME_SEARCH":a.isPaused=!1,J(),postMessage({type:"RESUMED",workerId:a.workerId});break;case"STOP_SEARCH":a.shouldStop=!0,a.isRunning=!1,postMessage({type:"STOPPED",workerId:a.workerId});break;case"PING":postMessage({type:"INITIALIZED",workerId:a.workerId,message:`Pong from worker ${a.workerId}`});break}};postMessage({type:"READY",workerId:a.workerId,message:`Parallel worker ${a.workerId} initialized`});
